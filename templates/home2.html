<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no"/>
    <title>OpenStreetMap</title>

    <style>
        .label-primary {
            background: #03a9f4;
        }

        #chart {
            height: 500px;
        }

        .node rect {
            cursor: move;
            fill-opacity: .9;
            shape-rendering: crispEdges;
        }

        .node text {
            pointer-events: none;
            text-shadow: 0 1px 0 #fff;
        }

        .link {
            fill: none;
            stroke: #000;
            stroke-opacity: .2;
        }

        .link:hover {
            stroke-opacity: .5;
        }

        .loader {
            position: absolute;
            left: 50%;
            top: 50%;
            z-index: 1;
            width: 150px;
            height: 150px;
            margin: -75px 0 0 -75px;
            border: 16px solid #f3f3f3;
            border-radius: 50%;
            border-top: 16px solid #3498db;
            width: 120px;
            height: 120px;
            -webkit-animation: spin 2s linear infinite;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .btn {
            cursor: pointer;
        }

        .bar {
            fill: #ff4d4d;
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: #D4D8DA;
            stroke-width: 1px;
            shape-rendering: crispEdges;
        }

        .x path {
            display: none;
        }

        html, body, #esri-map-container {
            padding: 0px;
            margin: 0px;
            height: 100%;
        }

        .media:hover {
            box-shadow: inset 0 0 0 3px #3a7999;
            cursor: pointer;
            box-shadow: 0px 0px 70px #000000;
            z-index: 2;
            -webkit-transition: all 200ms ease-in;
            -webkit-transform: scale(1.0);
            -ms-transition: all 200ms ease-in;
            -ms-transform: scale(1.0);
            -moz-transition: all 200ms ease-in;
            -moz-transform: scale(1.0);
            transition: all 200ms ease-in;
            transform: scale(1.0);
        }

        .hoverify {
            background-color: #e6f2ff;
            box-shadow: inset 0 0 0 2px #3a7999;
            cursor: pointer;
            box-shadow: 0px 0px 70px #000000;
            z-index: 2;
            -webkit-transition: all 200ms ease-in;
            -webkit-transform: scale(1.0);
            -ms-transition: all 200ms ease-in;
            -ms-transform: scale(1.0);
            -moz-transition: all 200ms ease-in;
            -moz-transform: scale(1.0);
            transition: all 200ms ease-in;
            transform: scale(1.0);
        }

        .media2:hover {
            cursor: pointer;
            z-index: 2;
            -webkit-transition: all 200ms ease-in;
            -webkit-transform: scale(1.2);
            -ms-transition: all 200ms ease-in;
            -ms-transform: scale(1.2);
            -moz-transition: all 200ms ease-in;
            -moz-transform: scale(1.2);
            transition: all 200ms ease-in;
            transform: scale(1.2);
        }

        .bar1 {
            fill: #6699ff;
        }

        .bar2 {
            fill: #ff5050;
        }

        .bar:hover {
            fill: #800000;
        }

        .bar1:hover {
            fill: #002b80;
        }

        .bar2:hover {
            fill: #800000;
        }

        .toolTip {
            position: absolute;
            display: none;
            min-width: auto;
            height: auto;
            background: none repeat scroll 0 0 #ffffff;
            border: 1px solid #6F257F;
            padding: 10px;
            text-align: center;
            z-index: 1000;
        }

        rect.bordered {
            stroke: #E6E6E6;
            stroke-width: 2px;
        }

        text.mono {
            font-size: 9pt;
            font-family: Consolas, courier;
            fill: #aaa;
        }

        text.axis-workweek {
            fill: #000;
        }

        text.axis-worktime {
            fill: #000;
        }
    </style>

    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
        }

        div#container {
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

        div#scroll {
            overflow: auto;
        }

        div#scrollNew {
            position: relative;
            overflow: auto;
        }

        .axis--grid .domain {
            fill: #ddd;
            stroke: none;
        }

        .axis--x .domain,
        .axis--grid .tick line {
            stroke: #fff;
        }

        .axis--grid .tick--minor line {
            stroke-opacity: .5;
        }

        .button {
            background-color: #e6e6e6;
            border: none;
            color: black;
            padding: 10px 15px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-family: "Calibri";
            font-size: 16px;
            margin: 2px 1px;
            cursor: pointer;
        }

        span.stars, span.stars span {
            display: block;
            background: url(/image/stars/) 0 -16px repeat-x;
            width: 80px;
            height: 16px;
        }

        span.stars span {
            background-position: 0 0;
        }

        .material-switch > input[type="checkbox"] {
            display: none;
        }

        .material-switch > label {
            cursor: pointer;
            height: 0px;
            position: relative;
            width: 40px;
        }

        .material-switch > label::before {
            background: rgb(0, 0, 0);
            box-shadow: inset 0px 0px 10px rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            content: '';
            height: 16px;
            margin-top: -8px;
            position: absolute;
            opacity: 0.3;
            transition: all 0.4s ease-in-out;
            width: 40px;
        }

        .material-switch > label::after {
            background: rgb(255, 255, 255);
            border-radius: 16px;
            box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.3);
            content: '';
            height: 24px;
            left: -4px;
            margin-top: -8px;
            position: absolute;
            top: -4px;
            transition: all 0.3s ease-in-out;
            width: 24px;
        }

        .material-switch > input[type="checkbox"]:checked + label::before {
            background: inherit;
            opacity: 0.5;
        }

        .material-switch > input[type="checkbox"]:checked + label::after {
            background: inherit;
            left: 20px;
        }

        #scroll2 {
            position: relative;
            overflow: auto;
        }

    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.3/esri/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/css/tether.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"
          integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jspanel3/3.7.0/jquery.jspanel.css"/>
    <link rel="stylesheet" href="https://www.w3schools.com/lib/w3.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.3/css/justifiedGallery.css"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='fancybox.css') }}"/>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/jquery.perfect-scrollbar/0.6.16/css/perfect-scrollbar.css"/>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/css/bootstrap-select.min.css">


    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <script>
        var script1 = document.createElement("script"),
            script2 = document.createElement("script"),
            script3 = document.createElement("script"),
            script4 = document.createElement("script"),
            script5 = document.createElement("script"),
            oldD3;

        function noConflict() {
            oldD3 = d3;
            console.log("loaded old");
            script2.type = 'text/javascript';
            script2.src = "https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.2/d3.min.js";
            script2.addEventListener("load", ready, false);
            document.head.appendChild(script2);


        }

        function ready() {
            console.log("loaded new");
            console.log(d3, oldD3);

            script3.type = 'text/javascript';
            script3.src = "{{ url_for('static', filename='nv.d3.min.js') }}";
            script3.addEventListener("load", disp, false);
            document.head.appendChild(script3);
        }
        function disp() {
            console.log("DONE");
            script4.type = 'text/javascript';
            script4.src = "{{ url_for('static', filename='stackedAreaChart.js') }}";
            script4.addEventListener("load", disp2, false);
            document.head.appendChild(script4);
        }
        function disp2() {
            console.log("DONE2");
            {#            script5.type = 'text/javascript';#}
            {#            script5.src = "https://rawgit.com/jasondavies/d3-cloud/master/build/d3.layout.cloud.js";#}
            {#            script5.addEventListener("load", disp3, false);#}
            {#            document.head.appendChild(script5);#}
        }
        function disp3() {
            console.log("DONE3");
        }
        script1.type = 'text/javascript';
        script1.src = "http://d3js.org/d3.v4.js";
        script1.addEventListener("load", noConflict, false);
        document.head.appendChild(script1);

    </script>

    <link rel="stylesheet" href="{{ url_for('static', filename='nv.d3.css') }}"/>

    <link rel="stylesheet" href="{{ url_for('static', filename='nv.d3.min.css') }}"/>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/jspanel3/3.6.0/jquery.jspanel-compiled.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"
            integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn"
            crossorigin="anonymous"></script>
    <script type="text/javascript" src="http://malsup.github.io/jquery.blockUI.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.3/js/jquery.justifiedGallery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.perfect-scrollbar/0.6.16/js/perfect-scrollbar.jquery.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.2/d3.min.js" charset="utf-8"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.10.3/babel.min.js'></script>


    {#    <script src="{{ url_for('static', filename='nv.d3.js') }}"></script>#}
    {#    <script src="{{ url_for('static', filename='nv.d3.min.js') }}"></script>#}
    {#    <script src="{{ url_for('static', filename='stackedAreaChart.js') }}"></script>#}

    <script src="{{ url_for('static', filename='fancybox.js') }}"></script>
    {#    <script src="{{ url_for('static', filename='d3-sankey.js') }}"></script>#}
    <script>

        /* Modified to work with d3.v4 build */
        (function (global, factory) {
            typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('d3-arrays'), require('d3-interpolate')) :
                typeof define === 'function' && define.amd ? define('d3-sankey', ['exports', 'd3-arrays', 'd3-interpolate'], factory) :
                    factory((global.d3_sankey = {}), global.d3_arrays, global.d3_interpolate);
        }(this, function (exports, d3Arrays, d3Interpolate) {
            'use strict';

            // Stolen from https://github.com/d3/d3-plugins/tree/master/sankey

            function sankey() {
                var sankey = {},
                    nodeWidth = 24,
                    nodePadding = 8,
                    size = [1, 1],
                    nodes = [],
                    links = [];

                sankey.nodeWidth = function (_) {
                    if (!arguments.length) return nodeWidth;
                    nodeWidth = +_;
                    return sankey;
                };

                sankey.nodePadding = function (_) {
                    if (!arguments.length) return nodePadding;
                    nodePadding = +_;
                    return sankey;
                };

                sankey.nodes = function (_) {
                    if (!arguments.length) return nodes;
                    nodes = _;
                    return sankey;
                };

                sankey.links = function (_) {
                    if (!arguments.length) return links;
                    links = _;
                    return sankey;
                };

                sankey.size = function (_) {
                    if (!arguments.length) return size;
                    size = _;
                    return sankey;
                };

                sankey.layout = function (iterations) {
                    computeNodeLinks();
                    computeNodeValues();
                    computeNodeBreadths();
                    computeNodeDepths(iterations);
                    computeLinkDepths();
                    return sankey;
                };

                sankey.relayout = function () {
                    computeLinkDepths();
                    return sankey;
                };

                sankey.link = function () {
                    var curvature = .5;

                    function link(d) {
                        var x0 = d.source.x + d.source.dx,
                            x1 = d.target.x,
                            xi = oldD3.interpolateNumber(x0, x1),
                            x2 = xi(curvature),
                            x3 = xi(1 - curvature),
                            y0 = d.source.y + d.sy + d.dy / 2,
                            y1 = d.target.y + d.ty + d.dy / 2;
                        return "M" + x0 + "," + y0 + "C" + x2 + "," + y0 + " " + x3 + "," + y1 + " " + x1 + "," + y1;
                    }

                    link.curvature = function (_) {
                        if (!arguments.length) return curvature;
                        curvature = +_;
                        return link;
                    };

                    return link;
                };

                // Populate the sourceLinks and targetLinks for each node.
                // Also, if the source and target are not objects, assume they are indices.
                function computeNodeLinks() {
                    nodes.forEach(function (node) {
                        node.sourceLinks = [];
                        node.targetLinks = [];
                    });
                    links.forEach(function (link) {
                        var source = link.source,
                            target = link.target;
                        if (typeof source === "number") source = link.source = nodes[link.source];
                        if (typeof target === "number") target = link.target = nodes[link.target];
                        source.sourceLinks.push(link);
                        target.targetLinks.push(link);
                    });
                }

                // Compute the value (size) of each node by summing the associated links.
                function computeNodeValues() {
                    nodes.forEach(function (node) {
                        node.value = Math.max(
                            oldD3.sum(node.sourceLinks, value),
                            oldD3.sum(node.targetLinks, value)
                        );
                    });
                }

                // Iteratively assign the breadth (x-position) for each node.
                // Nodes are assigned the maximum breadth of incoming neighbors plus one;
                // nodes with no incoming links are assigned breadth zero, while
                // nodes with no outgoing links are assigned the maximum breadth.
                function computeNodeBreadths() {
                    var remainingNodes = nodes,
                        nextNodes,
                        x = 0;

                    while (remainingNodes.length) {
                        nextNodes = [];
                        remainingNodes.forEach(function (node) {
                            node.x = x;
                            node.dx = nodeWidth;
                            node.sourceLinks.forEach(function (link) {
                                if (nextNodes.indexOf(link.target) < 0) {
                                    nextNodes.push(link.target);
                                }
                            });
                        });
                        remainingNodes = nextNodes;
                        ++x;
                    }

                    //
                    moveSinksRight(x);
                    scaleNodeBreadths((size[0] - nodeWidth) / (x - 1));
                }

                function moveSourcesRight() {
                    nodes.forEach(function (node) {
                        if (!node.targetLinks.length) {
                            node.x = oldD3.min(node.sourceLinks, function (d) {
                                    return d.target.x;
                                }) - 1;
                        }
                    });
                }

                function moveSinksRight(x) {
                    nodes.forEach(function (node) {
                        if (!node.sourceLinks.length) {
                            node.x = x - 1;
                        }
                    });
                }

                function scaleNodeBreadths(kx) {
                    nodes.forEach(function (node) {
                        node.x *= kx;
                    });
                }

                function computeNodeDepths(iterations) {
                    var nodesByBreadth = oldD3.nest()
                        .key(function (d) {
                            return d.x;
                        })
                        .sortKeys(oldD3.ascending)
                        .entries(nodes)
                        .map(function (d) {
                            return d.values;
                        });

                    //
                    initializeNodeDepth();
                    resolveCollisions();
                    for (var alpha = 1; iterations > 0; --iterations) {
                        relaxRightToLeft(alpha *= .99);
                        resolveCollisions();
                        relaxLeftToRight(alpha);
                        resolveCollisions();
                    }

                    function initializeNodeDepth() {
                        var ky = oldD3.min(nodesByBreadth, function (nodes) {
                            return (size[1] - (nodes.length - 1) * nodePadding) / oldD3.sum(nodes, value);
                        });

                        nodesByBreadth.forEach(function (nodes) {
                            nodes.forEach(function (node, i) {
                                node.y = i;
                                node.dy = node.value * ky;
                            });
                        });

                        links.forEach(function (link) {
                            link.dy = link.value * ky;
                        });
                    }

                    function relaxLeftToRight(alpha) {
                        nodesByBreadth.forEach(function (nodes, breadth) {
                            nodes.forEach(function (node) {
                                if (node.targetLinks.length) {
                                    var y = oldD3.sum(node.targetLinks, weightedSource) / oldD3.sum(node.targetLinks, value);
                                    node.y += (y - center(node)) * alpha;
                                }
                            });
                        });

                        function weightedSource(link) {
                            return center(link.source) * link.value;
                        }
                    }

                    function relaxRightToLeft(alpha) {
                        nodesByBreadth.slice().reverse().forEach(function (nodes) {
                            nodes.forEach(function (node) {
                                if (node.sourceLinks.length) {
                                    var y = oldD3.sum(node.sourceLinks, weightedTarget) / oldD3.sum(node.sourceLinks, value);
                                    node.y += (y - center(node)) * alpha;
                                }
                            });
                        });

                        function weightedTarget(link) {
                            return center(link.target) * link.value;
                        }
                    }

                    function resolveCollisions() {
                        nodesByBreadth.forEach(function (nodes) {
                            var node,
                                dy,
                                y0 = 0,
                                n = nodes.length,
                                i;

                            // Push any overlapping nodes down.
                            nodes.sort(ascendingDepth);
                            for (i = 0; i < n; ++i) {
                                node = nodes[i];
                                dy = y0 - node.y;
                                if (dy > 0) node.y += dy;
                                y0 = node.y + node.dy + nodePadding;
                            }

                            // If the bottommost node goes outside the bounds, push it back up.
                            dy = y0 - nodePadding - size[1];
                            if (dy > 0) {
                                y0 = node.y -= dy;

                                // Push any overlapping nodes back up.
                                for (i = n - 2; i >= 0; --i) {
                                    node = nodes[i];
                                    dy = node.y + node.dy + nodePadding - y0;
                                    if (dy > 0) node.y -= dy;
                                    y0 = node.y;
                                }
                            }
                        });
                    }

                    function ascendingDepth(a, b) {
                        return a.y - b.y;
                    }
                }

                function computeLinkDepths() {
                    nodes.forEach(function (node) {
                        node.sourceLinks.sort(ascendingTargetDepth);
                        node.targetLinks.sort(ascendingSourceDepth);
                    });
                    nodes.forEach(function (node) {
                        var sy = 0,
                            ty = 0;
                        node.sourceLinks.forEach(function (link) {
                            link.sy = sy;
                            sy += link.dy;
                        });
                        node.targetLinks.forEach(function (link) {
                            link.ty = ty;
                            ty += link.dy;
                        });
                    });

                    function ascendingSourceDepth(a, b) {
                        return a.source.y - b.source.y;
                    }

                    function ascendingTargetDepth(a, b) {
                        return a.target.y - b.target.y;
                    }
                }

                function center(node) {
                    return node.y + node.dy / 2;
                }

                function value(link) {
                    return link.value;
                }

                return sankey;
            };

            var version = "0.2.0";

            exports.version = version;
            exports.sankey = sankey;

        }));

    </script>
    <script>
        (function (f) {
            if (typeof exports === "object" && typeof module !== "undefined") {
                module.exports = f()
            } else if (typeof define === "function" && define.amd) {
                define([], f)
            } else {
                var g;
                if (typeof window !== "undefined") {
                    g = window
                } else if (typeof global !== "undefined") {
                    g = global
                } else if (typeof self !== "undefined") {
                    g = self
                } else {
                    g = this
                }
                g = (g.d3 || (g.d3 = {}));
                g = (g.layout || (g.layout = {}));
                g.cloud = f()
            }
        })(function () {
            var define, module, exports;
            return (function e(t, n, r) {
                function s(o, u) {
                    if (!n[o]) {
                        if (!t[o]) {
                            var a = typeof require == "function" && require;
                            if (!u && a)return a(o, !0);
                            if (i)return i(o, !0);
                            var f = new Error("Cannot find module '" + o + "'");
                            throw f.code = "MODULE_NOT_FOUND", f
                        }
                        var l = n[o] = {exports: {}};
                        t[o][0].call(l.exports, function (e) {
                            var n = t[o][1][e];
                            return s(n ? n : e)
                        }, l, l.exports, e, t, n, r)
                    }
                    return n[o].exports
                }

                var i = typeof require == "function" && require;
                for (var o = 0; o < r.length; o++)s(r[o]);
                return s
            })({
                1: [function (require, module, exports) {
// Word cloud layout by Jason Davies, https://www.jasondavies.com/wordcloud/
// Algorithm due to Jonathan Feinberg, http://static.mrfeinberg.com/bv_ch03.pdf

                    var dispatch = require("d3-dispatch").dispatch;

                    var cloudRadians = Math.PI / 180,
                        cw = 1 << 11 >> 5,
                        ch = 1 << 11;

                    module.exports = function () {
                        var size = [256, 256],
                            text = cloudText,
                            font = cloudFont,
                            fontSize = cloudFontSize,
                            fontStyle = cloudFontNormal,
                            fontWeight = cloudFontNormal,
                            rotate = cloudRotate,
                            padding = cloudPadding,
                            spiral = archimedeanSpiral,
                            words = [],
                            timeInterval = Infinity,
                            event = dispatch("word", "end"),
                            timer = null,
                            random = Math.random,
                            cloud = {},
                            canvas = cloudCanvas;

                        cloud.canvas = function (_) {
                            return arguments.length ? (canvas = functor(_), cloud) : canvas;
                        };

                        cloud.start = function () {
                            var contextAndRatio = getContext(canvas()),
                                board = zeroArray((size[0] >> 5) * size[1]),
                                bounds = null,
                                n = words.length,
                                i = -1,
                                tags = [],
                                data = words.map(function (d, i) {
                                    d.text = text.call(this, d, i);
                                    d.font = font.call(this, d, i);
                                    d.style = fontStyle.call(this, d, i);
                                    d.weight = fontWeight.call(this, d, i);
                                    d.rotate = rotate.call(this, d, i);
                                    d.size = ~~fontSize.call(this, d, i);
                                    d.padding = padding.call(this, d, i);
                                    return d;
                                }).sort(function (a, b) {
                                    return b.size - a.size;
                                });

                            if (timer) clearInterval(timer);
                            timer = setInterval(step, 0);
                            step();

                            return cloud;

                            function step() {
                                var start = Date.now();
                                while (Date.now() - start < timeInterval && ++i < n && timer) {
                                    var d = data[i];
                                    d.x = (size[0] * (random() + .5)) >> 1;
                                    d.y = (size[1] * (random() + .5)) >> 1;
                                    cloudSprite(contextAndRatio, d, data, i);
                                    if (d.hasText && place(board, d, bounds)) {
                                        tags.push(d);
                                        event.call("word", cloud, d);
                                        if (bounds) cloudBounds(bounds, d);
                                        else bounds = [{x: d.x + d.x0, y: d.y + d.y0}, {x: d.x + d.x1, y: d.y + d.y1}];
                                        // Temporary hack
                                        d.x -= size[0] >> 1;
                                        d.y -= size[1] >> 1;
                                    }
                                }
                                if (i >= n) {
                                    cloud.stop();
                                    event.call("end", cloud, tags, bounds);
                                }
                            }
                        }

                        cloud.stop = function () {
                            if (timer) {
                                clearInterval(timer);
                                timer = null;
                            }
                            return cloud;
                        };

                        function getContext(canvas) {
                            canvas.width = canvas.height = 1;
                            var ratio = Math.sqrt(canvas.getContext("2d").getImageData(0, 0, 1, 1).data.length >> 2);
                            canvas.width = (cw << 5) / ratio;
                            canvas.height = ch / ratio;

                            var context = canvas.getContext("2d");
                            context.fillStyle = context.strokeStyle = "red";
                            context.textAlign = "center";

                            return {context: context, ratio: ratio};
                        }

                        function place(board, tag, bounds) {
                            var perimeter = [{x: 0, y: 0}, {x: size[0], y: size[1]}],
                                startX = tag.x,
                                startY = tag.y,
                                maxDelta = Math.sqrt(size[0] * size[0] + size[1] * size[1]),
                                s = spiral(size),
                                dt = random() < .5 ? 1 : -1,
                                t = -dt,
                                dxdy,
                                dx,
                                dy;

                            while (dxdy = s(t += dt)) {
                                dx = ~~dxdy[0];
                                dy = ~~dxdy[1];

                                if (Math.min(Math.abs(dx), Math.abs(dy)) >= maxDelta) break;

                                tag.x = startX + dx;
                                tag.y = startY + dy;

                                if (tag.x + tag.x0 < 0 || tag.y + tag.y0 < 0 ||
                                    tag.x + tag.x1 > size[0] || tag.y + tag.y1 > size[1]) continue;
                                // TODO only check for collisions within current bounds.
                                if (!bounds || !cloudCollide(tag, board, size[0])) {
                                    if (!bounds || collideRects(tag, bounds)) {
                                        var sprite = tag.sprite,
                                            w = tag.width >> 5,
                                            sw = size[0] >> 5,
                                            lx = tag.x - (w << 4),
                                            sx = lx & 0x7f,
                                            msx = 32 - sx,
                                            h = tag.y1 - tag.y0,
                                            x = (tag.y + tag.y0) * sw + (lx >> 5),
                                            last;
                                        for (var j = 0; j < h; j++) {
                                            last = 0;
                                            for (var i = 0; i <= w; i++) {
                                                board[x + i] |= (last << msx) | (i < w ? (last = sprite[j * w + i]) >>> sx : 0);
                                            }
                                            x += sw;
                                        }
                                        delete tag.sprite;
                                        return true;
                                    }
                                }
                            }
                            return false;
                        }

                        cloud.timeInterval = function (_) {
                            return arguments.length ? (timeInterval = _ == null ? Infinity : _, cloud) : timeInterval;
                        };

                        cloud.words = function (_) {
                            return arguments.length ? (words = _, cloud) : words;
                        };

                        cloud.size = function (_) {
                            return arguments.length ? (size = [+_[0], +_[1]], cloud) : size;
                        };

                        cloud.font = function (_) {
                            return arguments.length ? (font = functor(_), cloud) : font;
                        };

                        cloud.fontStyle = function (_) {
                            return arguments.length ? (fontStyle = functor(_), cloud) : fontStyle;
                        };

                        cloud.fontWeight = function (_) {
                            return arguments.length ? (fontWeight = functor(_), cloud) : fontWeight;
                        };

                        cloud.rotate = function (_) {
                            return arguments.length ? (rotate = functor(_), cloud) : rotate;
                        };

                        cloud.text = function (_) {
                            return arguments.length ? (text = functor(_), cloud) : text;
                        };

                        cloud.spiral = function (_) {
                            return arguments.length ? (spiral = spirals[_] || _, cloud) : spiral;
                        };

                        cloud.fontSize = function (_) {
                            return arguments.length ? (fontSize = functor(_), cloud) : fontSize;
                        };

                        cloud.padding = function (_) {
                            return arguments.length ? (padding = functor(_), cloud) : padding;
                        };

                        cloud.random = function (_) {
                            return arguments.length ? (random = _, cloud) : random;
                        };

                        cloud.on = function () {
                            var value = event.on.apply(event, arguments);
                            return value === event ? cloud : value;
                        };

                        return cloud;
                    };

                    function cloudText(d) {
                        return d.text;
                    }

                    function cloudFont() {
                        return "serif";
                    }

                    function cloudFontNormal() {
                        return "normal";
                    }

                    function cloudFontSize(d) {
                        return Math.sqrt(d.value);
                    }

                    function cloudRotate() {
                        return (~~(Math.random() * 6) - 3) * 30;
                    }

                    function cloudPadding() {
                        return 1;
                    }

// Fetches a monochrome sprite bitmap for the specified text.
// Load in batches for speed.
                    function cloudSprite(contextAndRatio, d, data, di) {
                        if (d.sprite) return;
                        var c = contextAndRatio.context,
                            ratio = contextAndRatio.ratio;

                        c.clearRect(0, 0, (cw << 5) / ratio, ch / ratio);
                        var x = 0,
                            y = 0,
                            maxh = 0,
                            n = data.length;
                        --di;
                        while (++di < n) {
                            d = data[di];
                            c.save();
                            c.font = d.style + " " + d.weight + " " + ~~((d.size + 1) / ratio) + "px " + d.font;
                            var w = c.measureText(d.text + "m").width * ratio,
                                h = d.size << 1;
                            if (d.rotate) {
                                var sr = Math.sin(d.rotate * cloudRadians),
                                    cr = Math.cos(d.rotate * cloudRadians),
                                    wcr = w * cr,
                                    wsr = w * sr,
                                    hcr = h * cr,
                                    hsr = h * sr;
                                w = (Math.max(Math.abs(wcr + hsr), Math.abs(wcr - hsr)) + 0x1f) >> 5 << 5;
                                h = ~~Math.max(Math.abs(wsr + hcr), Math.abs(wsr - hcr));
                            } else {
                                w = (w + 0x1f) >> 5 << 5;
                            }
                            if (h > maxh) maxh = h;
                            if (x + w >= (cw << 5)) {
                                x = 0;
                                y += maxh;
                                maxh = 0;
                            }
                            if (y + h >= ch) break;
                            c.translate((x + (w >> 1)) / ratio, (y + (h >> 1)) / ratio);
                            if (d.rotate) c.rotate(d.rotate * cloudRadians);
                            c.fillText(d.text, 0, 0);
                            if (d.padding) c.lineWidth = 2 * d.padding, c.strokeText(d.text, 0, 0);
                            c.restore();
                            d.width = w;
                            d.height = h;
                            d.xoff = x;
                            d.yoff = y;
                            d.x1 = w >> 1;
                            d.y1 = h >> 1;
                            d.x0 = -d.x1;
                            d.y0 = -d.y1;
                            d.hasText = true;
                            x += w;
                        }
                        var pixels = c.getImageData(0, 0, (cw << 5) / ratio, ch / ratio).data,
                            sprite = [];
                        while (--di >= 0) {
                            d = data[di];
                            if (!d.hasText) continue;
                            var w = d.width,
                                w32 = w >> 5,
                                h = d.y1 - d.y0;
                            // Zero the buffer
                            for (var i = 0; i < h * w32; i++) sprite[i] = 0;
                            x = d.xoff;
                            if (x == null) return;
                            y = d.yoff;
                            var seen = 0,
                                seenRow = -1;
                            for (var j = 0; j < h; j++) {
                                for (var i = 0; i < w; i++) {
                                    var k = w32 * j + (i >> 5),
                                        m = pixels[((y + j) * (cw << 5) + (x + i)) << 2] ? 1 << (31 - (i % 32)) : 0;
                                    sprite[k] |= m;
                                    seen |= m;
                                }
                                if (seen) seenRow = j;
                                else {
                                    d.y0++;
                                    h--;
                                    j--;
                                    y++;
                                }
                            }
                            d.y1 = d.y0 + seenRow;
                            d.sprite = sprite.slice(0, (d.y1 - d.y0) * w32);
                        }
                    }

// Use mask-based collision detection.
                    function cloudCollide(tag, board, sw) {
                        sw >>= 5;
                        var sprite = tag.sprite,
                            w = tag.width >> 5,
                            lx = tag.x - (w << 4),
                            sx = lx & 0x7f,
                            msx = 32 - sx,
                            h = tag.y1 - tag.y0,
                            x = (tag.y + tag.y0) * sw + (lx >> 5),
                            last;
                        for (var j = 0; j < h; j++) {
                            last = 0;
                            for (var i = 0; i <= w; i++) {
                                if (((last << msx) | (i < w ? (last = sprite[j * w + i]) >>> sx : 0))
                                    & board[x + i]) return true;
                            }
                            x += sw;
                        }
                        return false;
                    }

                    function cloudBounds(bounds, d) {
                        var b0 = bounds[0],
                            b1 = bounds[1];
                        if (d.x + d.x0 < b0.x) b0.x = d.x + d.x0;
                        if (d.y + d.y0 < b0.y) b0.y = d.y + d.y0;
                        if (d.x + d.x1 > b1.x) b1.x = d.x + d.x1;
                        if (d.y + d.y1 > b1.y) b1.y = d.y + d.y1;
                    }

                    function collideRects(a, b) {
                        return a.x + a.x1 > b[0].x && a.x + a.x0 < b[1].x && a.y + a.y1 > b[0].y && a.y + a.y0 < b[1].y;
                    }

                    function archimedeanSpiral(size) {
                        var e = size[0] / size[1];
                        return function (t) {
                            return [e * (t *= .1) * Math.cos(t), t * Math.sin(t)];
                        };
                    }

                    function rectangularSpiral(size) {
                        var dy = 4,
                            dx = dy * size[0] / size[1],
                            x = 0,
                            y = 0;
                        return function (t) {
                            var sign = t < 0 ? -1 : 1;
                            // See triangular numbers: T_n = n * (n + 1) / 2.
                            switch ((Math.sqrt(1 + 4 * sign * t) - sign) & 3) {
                                case 0:
                                    x += dx;
                                    break;
                                case 1:
                                    y += dy;
                                    break;
                                case 2:
                                    x -= dx;
                                    break;
                                default:
                                    y -= dy;
                                    break;
                            }
                            return [x, y];
                        };
                    }

// TODO reuse arrays?
                    function zeroArray(n) {
                        var a = [],
                            i = -1;
                        while (++i < n) a[i] = 0;
                        return a;
                    }

                    function cloudCanvas() {
                        return document.createElement("canvas");
                    }

                    function functor(d) {
                        return typeof d === "function" ? d : function () {
                            return d;
                        };
                    }

                    var spirals = {
                        archimedean: archimedeanSpiral,
                        rectangular: rectangularSpiral
                    };

                }, {"d3-dispatch": 2}], 2: [function (require, module, exports) {
// https://d3js.org/d3-dispatch/ Version 1.0.2. Copyright 2016 Mike Bostock.
                    (function (global, factory) {
                        typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :
                            typeof define === 'function' && define.amd ? define(['exports'], factory) :
                                (factory((global.d3 = global.d3 || {})));
                    }(this, (function (exports) {
                        'use strict';

                        var noop = {
                            value: function () {
                            }
                        };

                        function dispatch() {
                            for (var i = 0, n = arguments.length, _ = {}, t; i < n; ++i) {
                                if (!(t = arguments[i] + "") || (t in _)) throw new Error("illegal type: " + t);
                                _[t] = [];
                            }
                            return new Dispatch(_);
                        }

                        function Dispatch(_) {
                            this._ = _;
                        }

                        function parseTypenames(typenames, types) {
                            return typenames.trim().split(/^|\s+/).map(function (t) {
                                var name = "", i = t.indexOf(".");
                                if (i >= 0) name = t.slice(i + 1), t = t.slice(0, i);
                                if (t && !types.hasOwnProperty(t)) throw new Error("unknown type: " + t);
                                return {type: t, name: name};
                            });
                        }

                        Dispatch.prototype = dispatch.prototype = {
                            constructor: Dispatch,
                            on: function (typename, callback) {
                                var _ = this._,
                                    T = parseTypenames(typename + "", _),
                                    t,
                                    i = -1,
                                    n = T.length;

                                // If no callback was specified, return the callback of the given type and name.
                                if (arguments.length < 2) {
                                    while (++i < n) if ((t = (typename = T[i]).type) && (t = get(_[t], typename.name))) return t;
                                    return;
                                }

                                // If a type was specified, set the callback for the given type and name.
                                // Otherwise, if a null callback was specified, remove callbacks of the given name.
                                if (callback != null && typeof callback !== "function") throw new Error("invalid callback: " + callback);
                                while (++i < n) {
                                    if (t = (typename = T[i]).type) _[t] = set(_[t], typename.name, callback);
                                    else if (callback == null) for (t in _) _[t] = set(_[t], typename.name, null);
                                }

                                return this;
                            },
                            copy: function () {
                                var copy = {}, _ = this._;
                                for (var t in _) copy[t] = _[t].slice();
                                return new Dispatch(copy);
                            },
                            call: function (type, that) {
                                if ((n = arguments.length - 2) > 0) for (var args = new Array(n), i = 0, n,
                                                                             t; i < n; ++i) args[i] = arguments[i + 2];
                                if (!this._.hasOwnProperty(type)) throw new Error("unknown type: " + type);
                                for (t = this._[type], i = 0, n = t.length; i < n; ++i) t[i].value.apply(that, args);
                            },
                            apply: function (type, that, args) {
                                if (!this._.hasOwnProperty(type)) throw new Error("unknown type: " + type);
                                for (var t = this._[type], i = 0,
                                         n = t.length; i < n; ++i) t[i].value.apply(that, args);
                            }
                        };

                        function get(type, name) {
                            for (var i = 0, n = type.length, c; i < n; ++i) {
                                if ((c = type[i]).name === name) {
                                    return c.value;
                                }
                            }
                        }

                        function set(type, name, callback) {
                            for (var i = 0, n = type.length; i < n; ++i) {
                                if (type[i].name === name) {
                                    type[i] = noop, type = type.slice(0, i).concat(type.slice(i + 1));
                                    break;
                                }
                            }
                            if (callback != null) type.push({name: name, value: callback});
                            return type;
                        }

                        exports.dispatch = dispatch;

                        Object.defineProperty(exports, '__esModule', {value: true});

                    })));

                }, {}]
            }, {}, [1])(1)
        });
    </script>
    <script src="https://js.arcgis.com/4.3/"></script>

    <script>
        var PID = localStorage.getItem("place-id");
        var map;
        var ldRoad;
        var ldRest;
        var ldMainRest;
        var ones = true;

        var panel2;
        var panelRest;

        $(document).ready(function () {
            // to do put id in localsoorage
            {#           localStorage.setItem("restaurantId", '58d34f94277142bdebc1216e');#}
            {#           localStorage.setItem("restaurantLong", -73.984115);#}
            {#           localStorage.setItem("restaurantLat", 40.726852);#}
            {#           [#}
            require([
                    "esri/Map",
                    "esri/views/MapView",
                    "esri/Graphic",
                    "esri/layers/TileLayer",
                    "esri/tasks/RouteTask",
                    "esri/tasks/support/RouteParameters",
                    "esri/core/urlUtils",
                    "esri/tasks/support/FeatureSet",
                    "esri/geometry/support/webMercatorUtils",
                    "esri/geometry/Point",
                    "esri/geometry/Polyline",
                    "esri/geometry/Polygon",
                    "esri/symbols/SimpleMarkerSymbol",
                    "esri/symbols/SimpleLineSymbol",
                    "esri/symbols/SimpleFillSymbol",
                    "esri/core/watchUtils",
                    "esri/config", "esri/symbols/PictureMarkerSymbol",
                    "dojo/domReady!"
                ], function (Map, MapView,
                             Graphic, TileLayer, RouteTask, RouteParameters, urlUtils, FeatureSet, webMercatorUtils, Point, Polyline, Polygon,
                             SimpleMarkerSymbol, SimpleLineSymbol, SimpleFillSymbol, watchUtils, esriConfig, PictureMarkerSymbol) {
                    var map = new Map("map", {
                        // basemap: "streets-night-vector"
                        //basemap: "osm"
                    });
                    var layer = new TileLayer({
                        url: "http://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"
                        // url:"http://services.arcgisonline.com/arcgis/rest/services/Canvas/World_Dark_Gray_Base/MapServer"
                    });
                    map.add(layer);

                    var view = new MapView({
                        center: [localStorage.getItem("lng"), localStorage.getItem("lat")],
                        container: "esri-map-container",
                        map: map,
                        zoom: 16
                    });
                    view.on("layerview-create", function () {
                        if (ones) {
                            ones = false;
                            $(document).ready(jQueryReady);
                        }
                    });

                    var west;
                    var south;
                    var north;
                    var east;

                    function jQueryReady() {


                        var creGraRest;
                        var graphi2l;


                        var con2 = '<button class="w3-button w3-circle"style="float: right; display: inline-block; font-size: 18px;" onclick="myFunction2()">&#10006;</button><div id="resData"></div><div id="wordCloud" style="height:400px; width:400px"></div>';

                        panelRest = $.jsPanel({
                            container: "#jsPanelRest",
                            position: {
                                left: 910,
                                top: 10
                            },
                            id: "panelRest",
                            contentSize: {width: 450, height: 740},
                            theme: "light",
                            headerRemove: true,
                            content: con2,
                            callback: function () {
                                this.content.css("padding", "15px");
                            }
                        });

                        jQuery("#scroll2").perfectScrollbar();
                        ldRoad = function LoadRoads() {
                            if ($("#restArea") != undefined)
                                $("#restArea").css("display", "none");
                            if ($("#placeArea") != undefined)
                                $("#placeArea").css("display", "block");


                            if (panelRest != undefined)
                                panelRest.hide();
                            if (panel2 != undefined)
                                panel2.show();
                            $("#restaurantOption").css("display", "none");
                            $("#placeFilterDiv").css("display", "block");
                            jQuery("#updateBt").addClass("btn-success");
                            jQuery("#updateBt").removeClass("btn-info");
                            jQuery(".placeChart").css("display", "block");
                            jQuery(".restChart").css("display", "none");
                            jQuery(".nearbyRestChart").css("display", "none");
                            view.zoom = 16;
                            $.blockUI({
                                css: {
                                    border: 'none',
                                    padding: '15px',
                                    backgroundColor: '#000',
                                    '-webkit-border-radius': '10px',
                                    '-moz-border-radius': '10px',
                                    opacity: .5,
                                    color: '#fff'
                                }
                            });

                            //***************************************ROAD DRAWING START**************************//

                            var bnds_latlong = webMercatorUtils.webMercatorToGeographic(view.extent);
                            east = bnds_latlong.extent.xmin;
                            south = bnds_latlong.extent.ymin;
                            north = bnds_latlong.extent.ymax;
                            west = bnds_latlong.extent.xmax;
                            console.log(north);

                            var finData = {
                                "crime_types": JSON.parse(localStorage.getItem("crime_types")),
                                "north": north,
                                "south": south,
                                "east": east,
                                "west": west
                            };

                            $.ajax({
                                async: true,
                                url: "/getRoadData",
                                type: 'POST',
                                data: JSON.stringify(finData),
                                timeout: 20000,
                                success: function (response) {
                                    /*************************
                                     * Create a polyline graphic
                                     *************************/
                                    if (view.graphics != undefined)
                                        view.graphics.removeAll();
                                    var layer = map.get('basemap');
                                    map.remove(layer);
                                    var layer = new TileLayer({
                                        //    url: "http://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"
                                        url: "http://services.arcgisonline.com/arcgis/rest/services/Canvas/World_Dark_Gray_Base/MapServer"
                                    });
                                    map.add(layer);

                                    view.zoom = 16;

                                    response = JSON.parse(response);
                                    // var color=["#2ca25f","#ffffbf","#d7191c"];
                                    responseRoads = response['roads'];
                                    var color = ["#d7191c",
                                        //"#fdae61",
                                        "#ffffbf",
                                        //"#a6d96a",
                                        "#1a9641"];
                                    color = color.reverse();
                                    for (var i = 0; i < responseRoads.length; i++) {

                                        // First create a line geometry (this is the Keystone pipeline)
                                        var polyline = new Polyline({
                                            paths: [[responseRoads[i]['source'][1], responseRoads[i]['source'][0]],
                                                [responseRoads[i]['destination'][1], responseRoads[i]['destination'][0]]
                                            ]
                                        });
                                        // Create a symbol for drawing the line
                                        var lineSymbol = new SimpleLineSymbol({
                                            color: color[responseRoads[i]['color'] - 1],
                                            width: 5
                                        });
                                        var name = "Undefined";
                                        var countt = 0;
                                        countt = responseRoads[i]['count'];
                                        var highway = "Undefined";
                                        if (responseRoads[i]['name'] != undefined)
                                            name = responseRoads[i]['name'];
                                        if (responseRoads[i]['highway'] != undefined)
                                            highway = responseRoads[i]['highway'];
                                        if (countt == 0) {
                                            countt = "0";
                                        }
                                        var lineAtt = {
                                            Name: name,
                                            Highway_Type: highway,
                                            Crime_Count: countt
                                        };

                                        var polylineGraphic = new Graphic({
                                            geometry: polyline,
                                            symbol: lineSymbol,
                                            attributes: lineAtt,
                                            popupTemplate: { // autocasts as new PopupTemplate()
                                                title: "{Name}",
                                                content: [{
                                                    type: "fields",
                                                    fieldInfos: [{
                                                        fieldName: "Name"
                                                    }, {
                                                        fieldName: "Highway_Type"
                                                    }, {
                                                        fieldName: "Crime_Count"
                                                    }]
                                                }]
                                            }
                                        });

                                        // Add the graphics to the view's graphics layer
                                        view.graphics.add(polylineGraphic);
                                    }


                                    /***************** HOSPITAL *************/
                                    responseHosp = response['hospitals'];
                                    for (var i = 0; i < responseHosp.length; i++) {
                                        var lat = responseHosp[i]['lat'];
                                        var lng = responseHosp[i]['lng'];

                                        var markerSymbol2 = new PictureMarkerSymbol('/image/hosp' + responseHosp[i]['color'] + '/', 30, 30);
                                        var graphi2 = new Graphic(
                                            new Point({latitude: lat, longitude: lng}));

                                        var countt = 0;
                                        var name = "Undefined";
                                        var created = "Undefined";
                                        countt = responseHosp[i]['count'];
                                        if (responseHosp[i]['name'] != undefined)
                                            name = responseHosp[i]['name'];
                                        if (responseHosp[i]['created'] != undefined)
                                            created = responseHosp[i]['created'];
                                        if (countt == 0) {
                                            countt = "0";
                                        }
                                        var lineAtt = {
                                            Name: name,
                                            Created_On: created,
                                            Crime_Count: countt
                                        };
                                        graphi2.attributes = lineAtt;
                                        graphi2.popupTemplate = { // autocasts as new PopupTemplate()
                                            title: "{Name}",
                                            content: [{
                                                type: "fields",
                                                fieldInfos: [{
                                                    fieldName: "Name"
                                                }, {
                                                    fieldName: "Created_On"
                                                }, {
                                                    fieldName: "Crime_Count"
                                                }]
                                            }]
                                        };

                                        graphi2.symbol = markerSymbol2;
                                        creGra = view.graphics.add(graphi2);
                                    }


                                    /***************** RAILWAY *************/
                                    responseRail = response['railways'];
                                    for (var i = 0; i < responseRail.length; i++) {
                                        var lat = responseRail[i]['lat'];
                                        var lng = responseRail[i]['lng'];

                                        var markerSymbol2 = new PictureMarkerSymbol('/image/rail' + responseRail[i]['color'] + '/', 22, 30);
                                        var graphi2 = new Graphic(
                                            new Point({latitude: lat, longitude: lng}));

                                        var countt = 0;
                                        var name = "Undefined";
                                        countt = responseRail[i]['count'];
                                        if (responseRail[i]['name'] != undefined)
                                            name = responseRail[i]['name'];
                                        if (countt == 0) {
                                            countt = "0";
                                        }
                                        var lineAtt = {
                                            Name: name,
                                            Crime_Count: countt
                                        };
                                        graphi2.attributes = lineAtt;
                                        graphi2.popupTemplate = { // autocasts as new PopupTemplate()
                                            title: "{Name}",
                                            content: [{
                                                type: "fields",
                                                fieldInfos: [{
                                                    fieldName: "Name"
                                                }, {
                                                    fieldName: "Crime_Count"
                                                }]
                                            }]
                                        };

                                        graphi2.symbol = markerSymbol2;
                                        creGra = view.graphics.add(graphi2);
                                    }

                                    /***************** PARKING *************/
                                    responsePark = response['parking'];
                                    for (var i = 0; i < responsePark.length; i++) {
                                        var lat = responsePark[i]['lat'];
                                        var lng = responsePark[i]['lng'];

                                        var markerSymbol2 = new PictureMarkerSymbol('/image/park' + responsePark[i]['color'] + '/', 30, 30);
                                        var graphi2 = new Graphic(
                                            new Point({latitude: lat, longitude: lng}));

                                        var countt = 0;
                                        var name = "Undefined";
                                        countt = responsePark[i]['count'];
                                        if (responsePark[i]['name'] != undefined)
                                            name = responsePark[i]['name'];
                                        if (countt == 0) {
                                            countt = "0";
                                        }
                                        var lineAtt = {
                                            Name: name,
                                            Crime_Count: countt
                                        };
                                        graphi2.attributes = lineAtt;
                                        graphi2.popupTemplate = { // autocasts as new PopupTemplate()
                                            title: "{Name}",
                                            content: [{
                                                type: "fields",
                                                fieldInfos: [{
                                                    fieldName: "Name"
                                                }, {
                                                    fieldName: "Crime_Count"
                                                }]
                                            }]
                                        };

                                        graphi2.symbol = markerSymbol2;
                                        creGra = view.graphics.add(graphi2);
                                    }


                                    /***************** BUS *************/
                                    responseBus = response['bus'];
                                    for (var i = 0; i < responseBus.length; i++) {
                                        var lat = responseBus[i]['lat'];
                                        var lng = responseBus[i]['lng'];

                                        var markerSymbol2 = new PictureMarkerSymbol('/image/bus' + responseBus[i]['color'] + '/', 30, 30);
                                        var graphi2 = new Graphic(
                                            new Point({latitude: lat, longitude: lng}));

                                        var countt = 0;
                                        var name = "Undefined";
                                        var route = "Undefined";

                                        countt = responseBus[i]['count'];
                                        if (responseBus[i]['name'] != undefined)
                                            name = responseBus[i]['name'];
                                        if (responseBus[i]['route'] != undefined)
                                            route = responseBus[i]['route'];
                                        if (countt == 0) {
                                            countt = "0";
                                        }
                                        var lineAtt = {
                                            Name: name,
                                            Route: route,
                                            Crime_Count: countt
                                        };
                                        graphi2.attributes = lineAtt;
                                        graphi2.popupTemplate = { // autocasts as new PopupTemplate()
                                            title: "{Name}",
                                            content: [{
                                                type: "fields",
                                                fieldInfos: [{
                                                    fieldName: "Name"
                                                }, {
                                                    fieldName: "Route"
                                                }, {
                                                    fieldName: "Crime_Count"
                                                }]
                                            }]
                                        };

                                        graphi2.symbol = markerSymbol2;
                                        creGra = view.graphics.add(graphi2);
                                    }

                                    /***************** POLICE *************/
                                    responsePolice = response['police'];
                                    for (var i = 0; i < responsePolice.length; i++) {
                                        var lat = responsePolice[i]['lat'];
                                        var lng = responsePolice[i]['lng'];

                                        var markerSymbol2 = new PictureMarkerSymbol('/image/police' + responsePolice[i]['color'] + '/', 40, 40);
                                        var graphi2 = new Graphic(
                                            new Point({latitude: lat, longitude: lng}));

                                        var countt = 0;
                                        var name = "Undefined";
                                        countt = responsePolice[i]['count'];
                                        if (responsePolice[i]['name'] != undefined)
                                            name = responsePolice[i]['name'];
                                        if (countt == 0) {
                                            countt = "0";
                                        }
                                        var lineAtt = {
                                            Name: name,
                                            Crime_Count: countt
                                        };
                                        graphi2.attributes = lineAtt;
                                        graphi2.popupTemplate = { // autocasts as new PopupTemplate()
                                            title: "{Name}",
                                            content: [{
                                                type: "fields",
                                                fieldInfos: [{
                                                    fieldName: "Name"
                                                }, {
                                                    fieldName: "Crime_Count"
                                                }]
                                            }]
                                        };

                                        graphi2.symbol = markerSymbol2;
                                        creGra = view.graphics.add(graphi2);
                                    }


                                    var lat = localStorage.getItem("lat");
                                    var lng = localStorage.getItem("lng");
                                    var markerSymbol2 = new PictureMarkerSymbol('/image/pin2/', 36, 60);
                                    markerSymbol2.yoffset = 20;
                                    var graphi2 = new Graphic(
                                        new Point({latitude: lat, longitude: lng}));
                                    graphi2.symbol = markerSymbol2;
                                    creGra = view.graphics.add(graphi2);

                                    // Call functions for bar charts
                                    $("#dropdown").val('Monday');

                                    report("Monday");
                                    crimeTypesBar();
                                    placeDetails();
                                    placesHorizontalBar();
                                    $.unblockUI();


                                    // MIHIR

                                    {#                                document.getElementById("myDiv1Loader").style.display = "block";#}
                                    {#                                document.getElementById("myDiv1").style.display = "none";#}
                                    {#                                // Inside at the end of Ajax#}
                                    displayStream();


                                },
                                error: function (XMLHttpRequest, textStatus, errorThrown) {
                                    $.unblockUI();
                                    response = "err--" + XMLHttpRequest.status + " -- " +
                                        XMLHttpRequest.statusText;
                                }
                            });


                            //***************************************ROAD DRAWING END**************************//


                        };

                        ldRest = function LoadRestaurants() {
                            panel2.hide();
                            jQuery(".mihirPlace").text(jQuery('#placeNamemihir').text());
                            if (panelRest != undefined)
                                panelRest.hide();

                            jQuery("#updateBt").addClass("btn-info");
                            jQuery("#updateBt").removeClass("btn-success");
                            jQuery(".placeChart").css("display", "none");
                            jQuery(".restChart").css("display", "none");
                            jQuery(".nearbyRestChart").css("display", "block");


                            $.blockUI({
                                css: {
                                    border: 'none',
                                    padding: '15px',
                                    backgroundColor: '#000',
                                    '-webkit-border-radius': '10px',
                                    '-moz-border-radius': '10px',
                                    opacity: .5,
                                    color: '#fff'
                                }
                            });
                            // ***** POPULATE RESTAURANTS ******* //
                            var options = ["crime", "police", "rating", "inspection_score", "hospital", "injury", "parking"];
                            var nearbyRestaurantDownPanel = {
                                'Dist': 5000,
                                "options": options,
                                'option': "",
                                'crime_types': JSON.parse(localStorage.getItem("crime_types")),
                                "coordinates": [
                                    parseFloat(localStorage.getItem("lng")),
                                    parseFloat(localStorage.getItem("lat"))
                                ]
                            };


                            $.ajax({
                                async: true,
                                url: "/getRestaurantFromPlace",
                                type: 'POST',
                                data: JSON.stringify(nearbyRestaurantDownPanel),
                                timeout: 20000,
                                contentType: "application/json; charset=utf-8",
                                dataType: "json",
                                success: function (response) {
                                    console.log(response['result']);
                                    var result = eval(response['result']);
                                    leftPanel2(result);


                                },
                                error: function (XMLHttpRequest, textStatus, errorThrown) {
                                    $.unblockUI();
                                    response = "err--" + XMLHttpRequest.status + " -- " +
                                        XMLHttpRequest.statusText;
                                }
                            });


                            function leftPanel2(result) {
                                var row = '';
                                row += '<div style="display: inline-block;">    <h1>Top Restaurants  <img src="https://image.freepik.com/free-icon/restaurant-cutlery-circular-symbol-of-a-spoon-and-a-fork-in-a-circle_318-61086.jpg" style="height: 25px; width:25px;"/></h1></div>';
                                for (var i = 0; i < result.length; i++) {
                                    row += '<div class="media mediaRest" onClick="openRest(this)"><span class="resId" style="visibility: hidden;display:none;">' + result[i].place_id + '</span><span class="reslatitude" style="visibility: hidden;display:none;">' + result[i].lat + '</span><span class="reslongitude" style="visibility: hidden;display:none;">' + result[i].lng + '</span><div class="media-body"> <br><h4 id="restNameOne" class="media-heading"><b>' + result[i].name;
                                    row += '</b></h4><p>' + result[i].formatted_address + '</p>';
                                    row += '<p>Rating: ' + result[i].rating + '<span class="stars">' + result[i].rating + '</span></p></div>';
                                    row += '<div class="media-left media-top"><br><img src="' + result[i].photo_reference + '" class="media-object" style="width:120px;height:125px;"></div></div><hr>';
                                }
                                $("#restArea").css("display", "block");
                                $("#placeArea").css("display", "none");
                                $("#restaurantOption").css("display", "block");
                                $("#placeFilterDiv").css("display", "none");
                                crime_filter.smallify();
                                jQuery('#rat12').prop('checked', true);
                                jQuery('#par12').prop('checked', true);
                                jQuery('#pol12').prop('checked', true);
                                jQuery('#hos12').prop('checked', true);
                                jQuery('#domh12').prop('checked', true);
                                jQuery('#inj12').prop('checked', true);
                                $('#restArea').html(row);
                                $.fn.stars = function () {
                                    return $(this).each(function () {
                                        $(this).html($('<span />').width(Math.max(0, (Math.min(5, parseFloat($(this).html())))) * 16));
                                    });
                                };
                                $('span.stars').stars();
                                jQuery(".media .placeId").each(function () {
                                    if (jQuery(this).html() == localStorage.getItem("place-id")) {
                                        jQuery(this).parent().addClass("hoverify");
                                    }
                                });
                            }


                            //***************************************RESTAURANT LOCATION LOADING START**************************//
                            var options = ["crime", "police", "rating", "inspection_score", "hospital", "injury", "parking"];

                            var finData = {
                                'Dist': 5000,
                                "options": options,
                                "coordinates": [
                                    parseFloat(localStorage.getItem("lng")),
                                    parseFloat(localStorage.getItem("lat"))],
                                'option': "",
                                'crime_types': JSON.parse(localStorage.getItem("crime_types"))
                            };
                            $.ajax({
                                async: true,
                                url: "/linedata",
                                type: 'POST',
                                data: JSON.stringify(finData),
                                timeout: 40000,
                                success: function (response) {
                                    /*************************
                                     * Create a polyline graphic
                                     *************************/
                                    response = JSON.parse(response);
                                    //console.log(response);
                                    if (view.graphics != undefined)
                                        view.graphics.removeAll();
                                    var layert = map.get('basemap');
                                    map.remove(layert);
                                    var layert = new TileLayer({
                                        url: "http://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"
                                        //     url:"http://services.arcgisonline.com/arcgis/rest/services/Canvas/World_Dark_Gray_Base/MapServer"
                                    });
                                    map.add(layert);
                                    view.zoom = 14;
                                    $('body').off('mouseover');
                                    $('body').off('mouseout');
                                    $('body').on('mouseover', '.mediaRest', function createGra() {
                                        var latl = $(this).find(".reslatitude").html();
                                        var lngl = $(this).find(".reslongitude").html();
                                        var markerSymbol2l = new PictureMarkerSymbol('/image/pin5/', 20, 30);
                                        markerSymbol2l.yoffset = 20;
                                        graphi2l = new Graphic(
                                            new Point({latitude: latl, longitude: lngl}));
                                        graphi2l.symbol = markerSymbol2l;
                                        creGraRest = view.graphics.add(graphi2l);
                                    });
                                    $('body').on('mouseout', '.mediaRest', function removeGra() {
                                        console.log(this);
                                        console.log(creGraRest);
                                        view.graphics.remove(graphi2l);
                                    });
                                    for (var i = 0; i < response.length; i++) {

                                        var lat = response[i]["lat"];
                                        var lng = response[i]["lng"];
                                        var markerSymbol2 = new PictureMarkerSymbol('/image/pin/', 20, 30);
                                        markerSymbol2.yoffset = 20;
                                        var graphi2 = new Graphic(new Point({latitude: lat, longitude: lng}));
                                        graphi2.symbol = markerSymbol2;

                                        var lineAtt = {
                                            Name: response[i]['name'],
                                            Rank: i + 1,
                                            Crime_Count: response[i]['crime_cnt'],
                                            Net_Rating: response[i]['net']
                                        };
                                        graphi2.attributes = lineAtt;
                                        graphi2.popupTemplate = { // autocasts as new PopupTemplate()
                                            title: "{Name}",
                                            content: [{
                                                type: "fields",
                                                fieldInfos: [{
                                                    fieldName: "Name"
                                                }, {
                                                    fieldName: "Rank"
                                                }, {
                                                    fieldName: "Crime_Count"
                                                }, {
                                                    fieldName: "Net_Rating"
                                                }]
                                            }]
                                        };

                                        creGra = view.graphics.add(graphi2);

                                    }

                                    var lat = localStorage.getItem("lat");
                                    var lng = localStorage.getItem("lng");
                                    var markerSymbol2 = new PictureMarkerSymbol('/image/pin2/', 36, 60);
                                    markerSymbol2.yoffset = 20;
                                    var graphi2 = new Graphic(
                                        new Point({latitude: lat, longitude: lng}));
                                    graphi2.symbol = markerSymbol2;
                                    creGra = view.graphics.add(graphi2);

                                    $.unblockUI();
                                    displayHorizontalBar();

                                },
                                error: function (XMLHttpRequest, textStatus, errorThrown) {
                                    $.unblockUI();
                                    response = "err--" + XMLHttpRequest.status + " -- " +
                                        XMLHttpRequest.statusText;
                                }
                            });


                            //***************************************RESTAURANT LOCATION LOADING END**************************//


                        };
                        ldMainRest = function () {
                            var routeParams = new RouteParameters({
                                stops: new FeatureSet(),
                                outSpatialReference: { // autocasts as new SpatialReference()
                                    wkid: 3857
                                }
                            });
                            var routeTask = new RouteTask({
                                url: "https://route.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World"
                            });
                            var stopSymbol = new SimpleMarkerSymbol({
                                style: "cross",
                                size: 15,
                                outline: { // autocasts as new SimpleLineSymbol()
                                    width: 4
                                }
                            });
                            var stop1 = new Graphic({
                                geometry: new Point({
                                    latitude: localStorage.getItem("lat"),
                                    longitude: localStorage.getItem("lng")
                                }),
                                symbol: stopSymbol
                            });
                            var stop2 = new Graphic({
                                geometry: new Point({
                                    latitude: localStorage.getItem("restLat"),
                                    longitude: localStorage.getItem("restLng")
                                }),
                                symbol: stopSymbol
                            });
                            // Execute the route task if 2 or more stops are input
                            routeParams.stops.features.push(stop1);
                            routeParams.stops.features.push(stop2);
                            console.log(routeParams, routeParams.stops.features);
                            console.log("AHAH" + typeof(routeParams.stops.features));
                            routeTask.solve(routeParams).then(showRoute);
                            var routeSymbol = new SimpleLineSymbol({
                                color: [0, 0, 255, 0.5],
                                width: 5
                            });
                            // Adds the solved route to the map as a graphic
                            function showRoute(data) {
                                if (view.graphics != undefined)
                                    view.graphics.removeAll();
                                var layer = map.get('basemap');
                                map.remove(layer);
                                var layero = new TileLayer({
                                    url: "http://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"
                                    //     url:"http://services.arcgisonline.com/arcgis/rest/services/Canvas/World_Dark_Gray_Base/MapServer"
                                });
                                map.add(layero);
                                console.log("in Main Rest");
                                view.zoom = 14;
                                var lato = localStorage.getItem("restLat");
                                var lngo = localStorage.getItem("restLng");
                                console.log(lato, lngo);
                                var markerSymbol2o = new PictureMarkerSymbol('/image/pin/', 20, 30);
                                markerSymbol2o.yoffset = 20;
                                var graphi2o = new Graphic(new Point({latitude: lato, longitude: lngo}));
                                graphi2o.symbol = markerSymbol2o;
                                {#                        var lineAtt = {#}
                                {#                            Name: response[i]['name'],#}
                                {#                            Rank: i + 1,#}
                                {#                            Crime_Count: response[i]['crime_cnt'],#}
                                {#                            Net_Rating: response[i]['net']#}
                                {#                        };#}
                                {#                        graphi2.attributes = lineAtt;#}
                                {#                        graphi2.popupTemplate = { // autocasts as new PopupTemplate()#}
                                {#                            title: "{Name}",#}
                                {#                            content: [{#}
                                {#                                type: "fields",#}
                                {#                                fieldInfos: [{#}
                                {#                                    fieldName: "Name"#}
                                {#                                }, {#}
                                {#                                    fieldName: "Rank"#}
                                {#                                }, {#}
                                {#                                    fieldName: "Crime_Count"#}
                                {#                                }, {#}
                                {#                                    fieldName: "Net_Rating"#}
                                {#                                }]#}
                                {#                            }]#}
                                {#                        };#}
                                creGra = view.graphics.add(graphi2o);
                                var lat = localStorage.getItem("lat");
                                var lng = localStorage.getItem("lng");
                                var markerSymbol2 = new PictureMarkerSymbol('/image/pin2/', 36, 60);
                                markerSymbol2.yoffset = 20;
                                var graphi2 = new Graphic(
                                    new Point({latitude: lat, longitude: lng}));
                                graphi2.symbol = markerSymbol2;
                                creGra = view.graphics.add(graphi2);
                                console.log("Reached");
                                console.log(data);
                                var routeResult = data.routeResults[0].route;
                                routeResult.symbol = routeSymbol;
                                view.graphics.add(routeResult);
                            }

                            $.unblockUI();
                        };
                        jQuery("#idLdRoad").click();

                        watchUtils.whenTrue(view, "stationary", function () {

                            // Get the new extent of the view only when view is stationary.
                            if (view.extent) {
                                var bnds_latlong = webMercatorUtils.webMercatorToGeographic(view.extent);
                                console.log(bnds_latlong);

                                west = bnds_latlong.extent.xmin;
                                south = bnds_latlong.extent.ymin;
                                north = bnds_latlong.extent.ymax;
                                east = bnds_latlong.extent.xmax;

                            }
                        });
                    }

                }
            );

        })
        ;
        function displayHorizontalBar() {

            var svg = oldD3.select("#horizontalBar"),
                margin = {
                    top: 20, right: 20, bottom: 60, left: 500
                },
                width = +svg.attr("width") - margin.left - margin.right,
                height = +svg.attr("height") - margin.top - margin.bottom;

            var tooltip = oldD3.select("body").append("div").attr("class", "toolTip");
            var x = oldD3.scaleLinear().range([0, width]);
            var y = oldD3.scaleBand().range([height, 0]);


            var Parameter = {
                "crime": "Criminal Activities nearby: ",
                "police": "Police Precincts nearby: ",
                "hospital": "Hospitals nearby: ",
                "parking": "Parking places neaby: ",
                "rating": "Rating: ",
                "injury": "Injuries nearby: ",
                "inspection_score": "Inspection Score: "
            };
            var data = [];

            console.log("ready!");
            oldD3.selectAll("#horizontalBar > *").remove();

            var g = svg.append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            var options = ["crime", "police", "rating", "inspection_score", "hospital", "injury", "parking"];

            var factor = jQuery("#factordropdown option:selected").attr("val");
            var finData = {
                "option": factor,
                "options": options,
                "Dist": 5000,
                "coordinates": [parseFloat(localStorage.getItem("lng")), parseFloat(localStorage.getItem("lat"))],
                "crime_types": JSON.parse(localStorage.getItem("crime_types"))
            };
            $.ajax({
                async: true,
                url: "/linedataMihir",
                type: 'POST',
                data: JSON.stringify(finData),
                timeout: 10000,
                success: function (response) {
                    response = JSON.parse(response);
                    console.log(response);
                    response = response["line"];
                    for (var i = 0; i < response.length; i++) {
                        var temp = {};
                        temp["area"] = response[i]["name"];
                        temp["value"] = response[i][factor];
                        data.push(temp);
                    }
                    x.domain([0, oldD3.max(data, function (d) {
                        return d.value;
                    })]);
                    y.domain(data.map(function (d) {
                        return d.area;
                    })).padding(0.1);

                    g.append("g")
                        .attr("class", "y axis")
                        .call(oldD3.axisLeft(y)).selectAll('text')
                        .style('font-size', '17px')
                        .style('font', 'arial', 'sans-serif');

                    g.append("g")
                        .attr("transform", "translate(0," + height + ")")
                        .call(oldD3.axisBottom(x)).selectAll('text')
                        .style('font-size', '17px')
                        .style('font', 'arial', 'sans-serif');
                    g.append("text")
                        .attr("transform",
                            "translate(" + (width / 2) + " ," +
                            (height + margin.top + 35) + ")")
                        .style("text-anchor", "middle")
                        .style("font-size", "25px")
                        .text("Crime Counts");

                    // text label for the y axis
                    g.append("text")
                        .attr("transform", "rotate(-90)")
                        .attr("y", 0 - margin.left)
                        .attr("x", 0 - (height / 2))
                        .attr("dy", "1em")
                        .style("text-anchor", "middle")
                        .style("font-size", "25px")
                        .text("Restaurant Name");
                    g.selectAll(".bar")
                        .data(data)
                        .enter().append("rect")
                        .attr("class", "bar")
                        .attr("x", 0)
                        .attr("height", y.bandwidth())
                        .attr("y", function (d) {
                            return y(d.area);
                        })
                        .attr("width", function (d) {
                            return x(d.value);
                        })
                        .on("mousemove", function (d) {
                            tooltip
                                .style("left", oldD3.event.pageX - 50 + "px")
                                .style("top", oldD3.event.pageY - 70 + "px")
                                .style("display", "inline-block")
                                .html((d.area) + "<br>" + Parameter[factor] + (d.value));
                        })
                        .on("mouseout", function (d) {
                            tooltip.style("display", "none");
                        });
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    response = "err--" + XMLHttpRequest.status + " -- " + XMLHttpRequest.statusText;
                }
            });
        }

        function placeDetails() {
            var map = {};
            var dayValue = '';
            console.log(PID);
            var finData = {"placeId": PID};

            $.ajax({
                async: true,
                url: "/getDetailForPlacesOfInterest",
                type: 'POST',
                data: JSON.stringify(finData),
                timeout: 10000,
                success: function (poi) {

                    //var json = JSON.stringify(eval("(" + poi + ")"));
                    var obj = JSON.parse(poi);
                    console.log(obj);
                    var news = "";
                    var arr = obj.newsArray;
                    for (var key in arr) {
                        news += '<div class="media"><a  href="' + arr[key].url + '" style="text-decoration:none; color: black;" target="_blank"><b>' + arr[key].headline + '</b><br>';
                        news += arr[key].content;
                        news += '</div></a><hr>';
                    }
                    $('#version3').html(news);

                    // TODO: CODE to be inserted here
                    var url_photus = "";
                    var pht = obj.photo_reference;
                    //console.log(pht);
                    for (var key in pht) {
                        //console.log(pht[key]);
                        url_photus += '<a  class="fancybox media2" data-lightbox="roadtrip" href="' + pht[key] + '">';
                        url_photus += '<img alt="' + key + '" src="' + pht[key] + '"/>';
                        url_photus += '</a>'
                    }

                    $('#version4').html(url_photus);

                    $("#version4").justifiedGallery({
                        rowHeight: 100,
                        lastRow: 'nojustify',
                        margins: 3
                    });
                    lightbox.option({
                        'resizeDuration': 200,
                        'wrapAround': true
                    });

                    var j = "";
                    j += '<button class="w3-button w3-circle"style="float: right; display: inline-block; font-size: 18px;" onclick="myFunction()">&#10006;</button><p><h3 id="placeNamemihir"><font style="Calibri" size=12><b>' + obj.name + '</b></font></h3></p>';
                    j += obj.rating + '&nbsp;&nbsp;<span class="stars" style="display: inline-block">' + obj.rating + '</span>';
                    j += '<br>' + obj.keyword + '';
                    j += '<a href=' + obj.website + ' class="button" target="_blank" style="float: right; text-decoration:none;">Website</a><br><br><hr>';
                    j += '<p><b>Address: </b>' + obj.formatted_address + '</p>';
                    j += '<p><b>Phone: </b>' + obj.formatted_phone_number + '</p>';
                    j += '<b>Hours: : &nbsp;&nbsp;</b>';
                    var dat = obj.opening_hours;
                    //console.log(obj.opening_hours);
                    var newSelect = document.createElement('select');
                    $('#version2').html(j);
                    var t = "";
                    t += '<option value="Please_Select">Please Select</option>';
                    for (var key in dat) {
                        //console.log(dat[key]);
                        map[key] = dat[key]
                        t += '<option value="' + key + '">' + key + '</option>';
                    }

                    console.log(map)
                    newSelect.innerHTML = t;

                    document.getElementById('version2').appendChild(newSelect);
                    $("#version2").append("  ");
                    $("#version2").append("&nbsp;&nbsp;");
                    var $appendElem = $('<div id ="vv" style="display: inline-block"></div>');
                    $appendElem.appendTo('#version2');
                    $.fn.stars = function () {
                        return $(this).each(function () {
                            $(this).html($('<span />').width(Math.max(0, (Math.min(5, parseFloat($(this).html())))) * 16));
                        });
                    }
                    $('span.stars').stars();

                    $("select").change(function () {

                        $('#vv').empty();
                        var day = $($('select :selected')[0]).text();
                        console.log(day);
                        console.log(map);
                        dayValue = map[day];
                        $('<p>' + dayValue + '</p>').appendTo('#vv');
                        //document.getElementById('version2').append( dayValue );
                        //alert(map[day]);
                    });

                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    response = "err--" + XMLHttpRequest.status + " -- " + XMLHttpRequest.statusText;
                }
            });
        }


        function crimeTypesBar() {


            oldD3.selectAll("#crimetypebar > *").remove();
            var margin = {top: 20, right: 40, bottom: 100, left: 30},
                width = 350 - margin.left - margin.right,
                height = 250 - margin.top - margin.bottom;

// set the ranges
            var x = oldD3.scaleLinear().range([0, width]);
            var y = oldD3.scaleBand().range([height, 0]);

            var svg = oldD3.select("#crimetypebar").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            var tooltip = oldD3.select("body").append("div").attr("class", "toolTip");


            var data = [];
            console.log("ready!");

            var g = svg.append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            var finData = {"placeId": PID};

            $.ajax({
                async: true,
                url: "/getPlaceCrimeTypes",
                type: 'POST',
                data: JSON.stringify(finData),
                timeout: 10000,
                success: function (response) {

                    console.log(response);
                    response = JSON.parse(response);
                    for (var key in response) {
                        var temp1 = {};
                        temp1["area"] = key;
                        //console.log(temp1["area"]);
                        var value1 = response[key];
                        temp1["value"] = value1;
                        //console.log(temp1["value"]);
                        data.push(temp1);
                    }
                    data.sort(function (a, b) {
                        return a.value - b.value;
                    });

                    x.domain([0, oldD3.max(data, function (d) {
                        return d.value;
                    })]);
                    y.domain(data.map(function (d) {
                        return d.area;
                    })).padding(0.1);

                    console.log("MADAR");
                    console.log(oldD3);


                    g.append("g")
                        .attr("class", "y axis")
                        .call(oldD3.axisLeft(y));
                    //.selectAll("text").remove();

                    g.append("g")
                        .attr("transform", "translate(0," + height + ")")
                        .call(oldD3.axisBottom(x));

                    g.selectAll(".bar")
                        .data(data)
                        .enter().append("rect")
                        .attr("class", "bar")
                        .attr("x", 0)
                        .attr("height", y.bandwidth())
                        .attr("y", function (d) {
                            return y(d.area);
                        })
                        .attr("width", function (d) {
                            return x(d.value);
                        })
                        .on("mousemove", function (d) {
                            tooltip
                                .style("left", oldD3.event.pageX - 50 + "px")
                                .style("top", oldD3.event.pageY - 70 + "px")
                                .style("display", "inline-block")
                                .html((d.area + "<br>" + d.value));
                        })
                        .on("mouseout", function (d) {
                            tooltip.style("display", "none");
                        });

                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    response = "err--" + XMLHttpRequest.status + " -- " + XMLHttpRequest.statusText;
                }
            });

        }

        function report(day) {

            oldD3.selectAll("#trend1 > *").remove();
            oldD3.selectAll("#trend2 > *").remove();
            var margin = {top: 20, right: 20, bottom: 30, left: 40},
                width = 350 - margin.left - margin.right,
                height = 150 - margin.top - margin.bottom;

            // set the ranges
            var x = oldD3.scaleBand()
                .range([0, width])
                .padding(0.1);
            var y = oldD3.scaleLinear()
                .range([height, 0]);

            var svg = oldD3.select("#trend1").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            var svg2 = oldD3.select("#trend2").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            var data1 = [];
            var data2 = [];
            var tooltip = oldD3.select("body").append("div").attr("class", "toolTip");
            var finData = {"placeId": PID, "day": day};

            $.ajax({
                async: true,
                url: "/getCrimeCountBarChartPLaces",
                type: 'POST',
                data: JSON.stringify(finData),
                timeout: 10000,
                success: function (response) {

                    response = JSON.parse(response);
                    console.log(response);
                    for (var key in response["popularTime"]) {
                        var temp1 = {};
                        temp1["salesperson"] = key;
                        var value1 = response["popularTime"][key];
                        temp1["sales"] = value1;
                        data1.push(temp1);
                    }
                    for (var key in response["crimeData"]) {
                        var temp2 = {};
                        temp2["salesperson"] = key;
                        var value2 = response["crimeData"][key];
                        temp2["sales"] = value2;
                        data2.push(temp2);
                    }

                    // Scale the range of the data in the domains
                    x.domain(data1.map(function (d) {
                        return d.salesperson;
                    }));
                    y.domain([0, 100]);

                    // append the rectangles for the bar chart
                    svg.selectAll(".bar1")
                        .data(data1)
                        .enter().append("rect")
                        .attr("class", "bar1")
                        .attr("x", function (d) {
                            return x(d.salesperson);
                        })
                        .attr("width", x.bandwidth())
                        .attr("y", function (d) {
                            return y(d.sales);
                        })
                        .attr("height", function (d) {
                            return height - y(d.sales);
                        })
                        .on("mousemove", function (d) {
                            tooltip
                                .style("left", oldD3.event.pageX - 50 + "px")
                                .style("top", oldD3.event.pageY - 70 + "px")
                                .style("display", "inline-block")
                                .html(d.sales);
                        })
                        .on("mouseout", function (d) {
                            tooltip.style("display", "none");
                        });

                    // add the x Axis
                    svg.append("g")
                        .attr("transform", "translate(0," + height + ")")
                        .call(oldD3.axisBottom(x));

                    // add the y Axis
                    svg.append("g")
                        .call(oldD3.axisLeft(y));


                    // Scale the range of the data in the domains
                    x.domain(data2.map(function (d) {
                        return d.salesperson;
                    }));
                    y.domain([0, 100]);

                    // append the rectangles for the bar chart
                    svg2.selectAll(".bar2")
                        .data(data2)
                        .enter().append("rect")
                        .attr("class", "bar2")
                        .attr("x", function (d) {
                            return x(d.salesperson);
                        })
                        .attr("width", x.bandwidth())
                        .attr("y", function (d) {
                            return y(d.sales);
                        })
                        .attr("height", function (d) {
                            return height - y(d.sales);
                        })
                        .on("mousemove", function (d) {
                            tooltip
                                .style("left", oldD3.event.pageX - 50 + "px")
                                .style("top", oldD3.event.pageY - 70 + "px")
                                .style("display", "inline-block")
                                .html(d.sales);
                        })
                        .on("mouseout", function (d) {
                            tooltip.style("display", "none");
                        });

                    // add the x Axis
                    svg2.append("g")
                        .attr("transform", "translate(0," + height + ")")
                        .call(oldD3.axisBottom(x));

                    // add the y Axis
                    svg2.append("g")
                        .call(oldD3.axisLeft(y));

                },

                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    response = "err--" + XMLHttpRequest.status + " -- " + XMLHttpRequest.statusText;
                }
            });
        }


    </script>
    <script>
        var con = '<div id="container"><div id="scroll2" style="height: 980px">';
        con += '<div id="version2" width="960" height="500"></div>';
        con += '<hr><div><h5>Views</h5><div style="width: 100%" class="btn-group btn-group-justified"><span style="width: 50%"id="idLdRoad" type="button" onclick="ldRoad()" class="btn btn-success">Place</span>';
        con += '<span style="width: 50%"  id="idLdRest" type="button" onclick="ldRest()" class="btn btn-info">Restaurants</span></div></div><hr>';
        con += '<div id="restArea"></div><div id="placeArea"><div style="margin: auto;" ><div style="display: table-cell; width: auto; float:right">';
        con += '<label for="dropdown" ></label><select id="dropdown" onchange="report(this.value)"><option val="Monday">Monday</option><option val="Tuesday">Tuesday</option><option val="Wednesday">Wednesday</option><option val="Thursday">Thursday</option><option val="Friday">Friday</option>';
        con += '<option val="Saturday">Saturday</option><option val="Sunday">Sunday</option></select></div></div><h5>Hourly Popularity</h5><div id="trend1"></div><hr><h5>Hourly Crime Counts</h5><div id="trend2"></div><hr><h5>Photos</h5><div id="version4"></div><hr><h5>Top 5 Crime Types</h5>';
        con += '<div id="crimetypebar"></div><hr><img style="width:auto; height:7%;" src="https://myaccount.nytimes.com/img/nyt-logo-379x64.svg"/><br><hr><div id="version3" width="960" height="500"></div></div></div></div>';
        var placeofInterestLeftPanel = {
            "crime": JSON.parse(localStorage.getItem("crime_types")),
            "rating": localStorage.getItem("rating"),
            "review": localStorage.getItem("review"),
            "startTime": localStorage.getItem("startTime"),
            "endTime": localStorage.getItem("endTime")
        };
        var crime_filter;

        function checkAll() {
            if (jQuery('#someSwitchOptionPrimary234').is(':checked')) {
                jQuery('.crimeC').each(function () {
                    jQuery(this).prop('checked', true);
                })
            }
            else {
                jQuery('.crimeC').each(function () {
                    jQuery(this).prop('checked', false);
                })
            }
        }
        $(document).ready(function () {
            panel2 = $.jsPanel({
                container: "#jsPanelLegend",
                position: {
                    left: 2420,
                    top: 800
                },
                id: "legendPanel",
                contentSize: {width: 100, height: 300},
                theme: "light",
                headerRemove: true,
                content: '<img src="https://s28.postimg.org/knqz93i65/final_Leg.png"   style="height: 300px; width: 100px;">',
                callback: function () {
                    this.content.css("padding", "0px");
                }
            });

            // js panel don't put anything above
            var panel1 = $.jsPanel({
                container: "#jsPanelPlace",
                position: {
                    left: 450,
                    top: 10
                },
                id: "placePanel",
                contentSize: {width: 450, height: 1000},
                theme: "light",
                headerRemove: true,
                content: con,
                callback: function () {
                    this.content.css("padding", "15px");
                }
            });


            jQuery("#scroll2").perfectScrollbar();
            // js panel crime filter
            crime_filter = $.jsPanel({
                container: "#jsPanelCheck",
                position: {
                    left: 2000,
                    top: 20
                },
                contentSize: {width: 400, height: 1030},
                theme: "info",
                headerTitle: "Filter",
                content: '<div style="height:60%"><h2>Crime Type</h2>\
                       <div id="myDiv" style="overflow:auto; height:90%"></div></div><hr size="30"><div id="restaurantOption" style="height:20%"><h2>Restaurants Filter</h2>\<span class="material-switch">\
                            <input id="rat12" name="rat123" type="checkbox"/>\
                            <label for="rat12" class="label-primary"></label>\
                        </span> <span style="font-size: 18px ;padding-left: 10px;">Restaurant Rating</span>\
                        <br><span class="material-switch">\
                            <input id="par12" name="par123" type="checkbox"/>\
                            <label for="par12" class="label-primary"></label>\
                        </span> <span style="font-size: 18px ;padding-left: 10px;">Parking Places</span>\
                        \<br><span class="material-switch">\
                            <input id="pol12" name="pol123" type="checkbox"/>\
                            <label for="pol12" class="label-primary"></label>\
                        </span> <span style="font-size: 18px ;padding-left: 10px;">Police Precincts</span>\
                        \<br><span class="material-switch">\
                            <input id="hos12" name="hos123" type="checkbox"/>\
                            <label for="hos12" class="label-primary"></label>\
                        </span> <span style="font-size: 18px ;padding-left: 10px;">Hospitals</span>\
                        \<br><span class="material-switch">\
                            <input id="domh12" name="domh123" type="checkbox"/>\
                            <label for="domh12" class="label-primary"></label>\
                        </span> <span style="font-size: 18px ;padding-left: 10px;">New York City Department of Health and Mental Hygiene Inspection Score</span>\
                        \<br><span class="material-switch">\
                            <input id="inj12" name="inj123" type="checkbox"/>\
                            <label for="inj12" class="label-primary"></label>\
                        </span> <span style="font-size: 18px ;padding-left: 10px;">Injuries and Fatalities</span>\
                        <br><br></div><div id="placeFilterDiv" style="height:20%"><h2>Ratings Filter</h2>\<br><span class="material-switch">\
                            <input id="someSwitchOptionPrimary123" name="someSwitchOption001" type="checkbox"/>\
                            <label for="someSwitchOptionPrimary123" class="label-primary"></label>\
                        </span> <span style="font-size: 18px ;padding-left: 10px;">Rating Stars</span>\
                        <br><span class="material-switch">\
                            <input id="someSwitchOptionPrimary12345" name="someSwitchOption0012" type="checkbox"/>\
                            <label for="someSwitchOptionPrimary12345" class="label-primary"></label>\
                        </span> <span style="font-size: 18px ;padding-left: 10px;">Review Count</span>\
                        <br></div><hr size="30"><div> <button type="button" class="btn btn-primary btn-lg btn-block" id="updateBt">Search</button></div>',
                callback: function () {
                    this.content.css("padding", "15px");
                }
            });
            $("#updateBt").click(function () {
                savePage();
                if (jQuery("#updateBt").hasClass("btn-success")) {
                    console.log("road");
                    jQuery("#idLdRoad").click();
                }
                if (jQuery("#updateBt").hasClass("btn-info")) {
                    console.log("rest");
                    jQuery("#idLdRest").click();
                }
            });

            $.getJSON('http://www.localhost:5000/getCrimeFIlter', function (poi) {


                var test = '';
                test += '<br><span id="checkAll234" class="material-switch">';
                test += '<input id="someSwitchOptionPrimary234" name="someSwitchOption222" type="checkbox" onclick="checkAll()"/>';
                test += '<label for="someSwitchOptionPrimary234" class="label-primary"></label>\</span> <span style="font-size: 18px ;padding-left: 10px;">All</span>';
                test += '<br>';
                for (var i = 0; i < poi.result.length; i++) {
                    test += '<br><span class="material-switch"><input class="crimeC" id="someSwitchOptionPrimary' + i + '" name="someSwitchOption00' + i + '" type="checkbox"/><label for="someSwitchOptionPrimary' + i + '" class="label-primary"></label>';
                    test += '</span> <span style="font-size: 13px;padding-left: 10px;">' + poi.result[i] + '</span><br>';
                }
                $('#myDiv').html(test);
                var crime_list = JSON.parse(localStorage.getItem("crime_types"))
                jQuery('.crimeC').each(function () {
                    if (jQuery(this)) {
                        crim_name = jQuery(jQuery(this).parent()).next(3).html();
                        if (crime_list.indexOf(crim_name) != -1)
                            jQuery(this).prop('checked', true);
                    }
                });
                if (localStorage.getItem("rating") == "true")
                    jQuery('#someSwitchOptionPrimary123').prop('checked', true);
                if (localStorage.getItem("review") == "true")
                    jQuery('#someSwitchOptionPrimary12345').prop('checked', true);


            });

            crime_filter.smallify();
            // ajax call for left panel
            $.ajax({
                async: true,
                url: "/getCrimeFilterData",
                type: 'POST',
                data: JSON.stringify(placeofInterestLeftPanel),
                timeout: 20000,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    console.log(response);
                    var result = eval(response['result']);
                    leftPanel(result);
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    $.unblockUI();
                    response = "err--" + XMLHttpRequest.status + " -- " +
                        XMLHttpRequest.statusText;
                }
            });
            // ajax call for crime filter
        });


        function myFunction2() {
            panelRest.hide();
            ldRest();
            jQuery(".placeChart").css("display", "none");
            jQuery(".restChart").css("display", "none");
            jQuery(".nearbyRestChart").css("display", "block");
        }
        function openRest(element) {
            var resId = $(element).find(".resId").html();
            console.log(resId);
            var lat = $(element).find(".reslatitude").html();
            var lng = $(element).find(".reslongitude").html();
            var name = $(element).find("#restNameOne").text();
            localStorage.setItem("restLat", lat);
            localStorage.setItem("restLng", lng);
            ldMainRest();
            jQuery(".placeChart").css("display", "none");
            jQuery(".restChart").css("display", "block");
            jQuery(".nearbyRestChart").css("display", "none");


            // CALL GRAPH FUNCTION LOCALSTORAGE
            panel2.hide();
            panelRest.show();


            localStorage.setItem("restaurantId", resId);
            localStorage.setItem("restaurantLong", parseFloat(lng));
            localStorage.setItem("restaurantLat", parseFloat(lat));

            jQuery(".myTitle").text(name);
            var resDetail = {'resId': localStorage.getItem("restaurantId")};
            $.ajax({
                async: true,
                url: "/getRestaurantDetail",
                type: 'POST',
                data: JSON.stringify(resDetail),
                timeout: 20000,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (poi) {
                    var j = "";
                    console.log(poi);
                    var obj = poi;
                    var j = "";
                    j += '<p><h3><font style="Calibri" size=12><b>' + obj.name + '</b></font></h3></p>';
                    j += obj.rating + '&nbsp;&nbsp;<span class="stars" style="display: inline-block">' + obj.rating + '</span>';
                    j += '<br>' + obj.cuisine + '';
                    j += '<a href=' + obj.url + ' class="button" target="_blank" style="float: right; text-decoration:none;">Website</a><br><br><hr>';
                    j += '<p><b>Address: </b>' + obj.address + '</p>';
                    j += '<p><b>Phone: </b>' + obj.phone + '</p><hr>';

                    $('#resData').html(j);
                    $.fn.stars = function () {
                        return $(this).each(function () {
                            $(this).html($('<span />').width(Math.max(0, (Math.min(5, parseFloat($(this).html())))) * 16));
                        });
                    }
                    $('span.stars').stars();

                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    $.unblockUI();
                    response = "err--" + XMLHttpRequest.status + " -- " +
                        XMLHttpRequest.statusText;
                }
            });
            // js panel don't put anything above


            var wordCld = [];
            var resCloudId = {"placeId": localStorage.getItem("restaurantId")};

            $.ajax({
                async: true,
                url: "/getWordCloudData",
                type: 'POST',
                data: JSON.stringify(resCloudId),
                timeout: 20000,
                success: function (poi) {
                    var json = JSON.stringify(eval("(" + poi + ")"));
                    var obj = JSON.parse(json);
                    console.log(json);
                    var j = "";
                    for (var i = 0; i < obj.length; i++) {
                        //console.log(obj[i]);
                        j = j + " " + obj[i];
                    }
                    //console.log(j);
                    wordCld[0] = j;
                    console.log(wordCld[0]);
                    //Start cycling through the demo data
                    showNewWords(myWordCloud);
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    response = "err--" + XMLHttpRequest.status + " -- " + XMLHttpRequest.statusText;
                }
            });
            function wordCloudD(selector) {
                var fillk = d3.scale.category20();

                //Construct the word cloud's SVG element
                oldD3.selectAll("#wordCloud > *").remove();
                var svgk = d3.select(selector).append("svg")
                    .attr("width", 400)
                    .attr("height", 400)
                    .append("g")
                    .attr("transform", "translate(200,200)");


                //Draw the word cloud
                function draw(words) {
                    var cloudk = svgk.selectAll("g text")
                        .data(words, function (d) {
                            return d.text;
                        })

                    //Entering words
                    cloudk.enter()
                        .append("text")
                        .style("font-family", "Impact")
                        .style("fill", function (d, i) {
                            return fillk(i);
                        })
                        .attr("text-anchor", "middle")
                        .attr('font-size', 1)
                        .text(function (d) {
                            return d.text;
                        });

                    //Entering and existing words
                    cloudk
                        .transition()
                        .duration(600)
                        .style("font-size", function (d) {
                            return d.size + "px";
                        })
                        .attr("transform", function (d) {
                            return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                        })
                        .style("fill-opacity", 1);

                    //Exiting words
                    cloudk.exit()
                        .transition()
                        .duration(200)
                        .style('fill-opacity', 1e-6)
                        .attr('font-size', 1)
                        .remove();
                }


                //Use the module pattern to encapsulate the visualisation code. We'll
                // expose only the parts that need to be public.
                return {

                    //Recompute the word cloud for a new set of words. This method will
                    // asycnhronously call draw when the layout has been computed.
                    //The outside world will need to call this function, so make it part
                    // of the wordCloud return value.
                    update: function (words) {
                        d3.layout.cloud().size([400, 400])
                            .words(words)
                            .padding(5)
                            .rotate(function () {
                                return ~~(Math.random() * 2) * 90;
                            })
                            .font("Impact")
                            .fontSize(function (d) {
                                return d.size;
                            })
                            .on("end", draw)
                            .start();
                    }
                }


            }

            //

            //Prepare one of the sample sentences by removing punctuation,
            // creating an array of words and computing a random size attribute.
            function getWords(i) {
                return wordCld[i]
                    .replace(/[!\.,:;\?]/g, '')
                    .split(' ')
                    .map(function (d) {
                        return {text: d, size: 10 + Math.random() * 60};
                    })
            }

            //This method tells the word cloud to redraw with a new set of words.
            //In reality the new words would probably come from a server request,
            // user input or some other source.
            function showNewWords(vis, i) {
                i = i || 0;
                //console.log(i % words.length);
                vis.update(getWords(i++ % wordCld.length));
                setTimeout(function () {
                    showNewWords(vis, i + 1)
                }, 6000)
            }

            //Create a new instance of the word cloud visualisation.
            var myWordCloud = wordCloudD('#wordCloud');

            boxPlot();
            getDataHeat();
            displayBubble();
            displaySankey();

        }


        function myFunction() {
            console.log();
            $('#placePanel').remove();
            localStorage.setItem("set_Cross", true);
            window.open("/", "_self");
        }


        function leftPanel(result) {
            var row = '';
            for (var i = 0; i < result.length; i++) {
                row += '<div class="media" onClick="nextPage(this)"><span class="placeId" style="visibility: hidden;display:none;">' + result[i].place_id + '</span><span class="latitude" style="visibility: hidden;display:none;">' + result[i].lat + '</span><span class="longitude" style="visibility: hidden;display:none;">' + result[i].lng + '</span><div class="media-body"> <br><h4 class="media-heading"><b>' + result[i].name;
                row += '</b></h4><p>' + result[i].formatted_address + '</p>';
                row += '<p>Rating: ' + result[i].rating + '<span class="stars">' + result[i].rating + '</span></p></div>';
                row += '<div class="media-left media-top"><br><img src="' + result[i].photo_reference + '" class="media-object" style="width:120px;height:125px;"></div></div><hr>';
            }
            $('#placeOf').html(row);
            $.fn.stars = function () {
                return $(this).each(function () {
                    $(this).html($('<span />').width(Math.max(0, (Math.min(5, parseFloat($(this).html())))) * 16));
                });
            };
            $('span.stars').stars();
            jQuery(".media .placeId").each(function () {
                if (jQuery(this).html() == localStorage.getItem("place-id")) {
                    jQuery(this).parent().addClass("hoverify");
                }
            });
            jQuery("#scrollNew").perfectScrollbar();
        }


        function nextPage(element) {
            var placeId = $(element).find(".placeId").html();
            console.log(placeId);
            var lat = $(element).find(".latitude").html();
            var lng = $(element).find(".longitude").html();

            var arr = [];
            var i = 0;
            jQuery('.crimeC').each(function () {
                if (jQuery(this).is(':checked')) {
                    arr[i] = jQuery(jQuery(this).parent()).next(3).html();
                    i++;
                }
            });
            localStorage.setItem("crime_types", JSON.stringify(arr));
            localStorage.setItem("place-id", placeId);
            localStorage.setItem("lng", lng);
            localStorage.setItem("lat", lat);
            window.open("/home2", "_self");
        }
        function savePage() {
            var arr = [];
            var i = 0;
            jQuery('.crimeC').each(function () {
                if (jQuery(this).is(':checked')) {
                    arr[i] = jQuery(jQuery(this).parent()).next(3).html();
                    i++;
                }
            });
            localStorage.setItem("crime_types", JSON.stringify(arr));
            var rt = jQuery('#someSwitchOptionPrimary123').is(':checked');
            var rv = jQuery('#someSwitchOptionPrimary12345').is(':checked');
            localStorage.setItem("rating", rt);
            localStorage.setItem("review", rv);
        }
    </script>

    <script>

        function displayStream() {
            $.ajax({
                async: true,
                url: "/streamdata",
                type: 'GET',
                timeout: 40000,
                success: function (response) {
                    response = JSON.parse(response);
                    console.log(response);
                    //console.log(histcatexplong);
                    var histcatexplong = response;
                    var colors = d3.scale.category20();

                    var chart;
                    nv.addGraph(function () {
                        chart = nv.models.stackedAreaChart()
                            .useInteractiveGuideline(true)
                            .x(function (d) {

                                return d[0]
                            })
                            .y(function (d) {
                                return d[1]
                            })
                            .controlLabels({stacked: "Stacked"})
                            .duration(300);

                        chart.xAxis.tickFormat(function (d) {
                            console.log("A", d);
                            return d3.time.format('%A')(new Date(d))
                        });
                        chart.yAxis.tickFormat(d3.format(',.4f'));

                        chart.legend.vers('furious');

                        histcatexplong = histcatexplong.map(function (series) {
                            if (series.placeId != localStorage.getItem("place-id")) {
                                series.disabled = true;
                            }
                            series.values=series.values.slice(0, 7);
                            return series;
                        });
                        console.log("A", histcatexplong);
                        d3.select('#chart1')
                            .datum(histcatexplong)
                            .transition().duration(1000)
                            .call(chart)
                            .each('start', function () {
                                setTimeout(function () {
                                    d3.selectAll('#chart1 *').each(function () {
                                        if (this.__transition__)
                                            this.__transition__.duration = 1;
                                    })
                                }, 0)
                            });

                        nv.utils.windowResize(chart.update);
                        return chart;
                    });
                    document.getElementById("myDiv1Loader").style.display = "none";
                    document.getElementById("myDiv1").style.display = "block";
                    jQuery("#newp2").click();
                    jQuery("#newp").click();
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    response = "err--" + XMLHttpRequest.status + " -- " + XMLHttpRequest.statusText;
                }
            });
        }
    </script>
    {#<script src="{{ url_for('static', filename='d3-scale-radial.js') }}"></script>#}

    <script type="text/javascript">
        var chart;
        function createDonut(value1, value2, name1, rest1, rest2, container) {
            chart = new CanvasJS.Chart(container,
                {
                    backgroundColor: "#333",
                    title: {
                        fontColor: "white",
                        text: name1
                    },
                    animationEnabled: true,
                    data: [
                        {
                            indexLabelFontColor: "white",
                            type: "doughnut",
                            startAngle: 270,
                            toolTipContent: "{legendText}: {y} - <strong>#percent% </strong>",
                            showInLegend: false,
                            dataPoints: [
                                {y: value1, indexLabel: rest1 + " #percent% ", legendText: rest1},
                                {y: value2, indexLabel: rest2 + " #percent% ", legendText: rest2}
                            ]
                        }
                    ]
                });
            chart.render();
        }
    </script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/canvasjs/1.7.0/canvasjs.js"></script>


    <script>
        function scaleRadial() {
            var domain = [0, 1],
                range = [0, 1];

            function scale(x) {
                var r0 = range[0] * range[0], r1 = range[1] * range[1];
                return Math.sqrt((x - domain[0]) / (domain[1] - domain[0]) * (r1 - r0) + r0);
            }

            scale.domain = function (_) {
                return arguments.length ? (domain = [+_[0], +_[1]], scale) : domain.slice();
            };

            scale.range = function (_) {
                return arguments.length ? (range = [+_[0], +_[1]], scale) : range.slice();
            };

            scale.ticks = function (count) {
                return oldD3.scaleLinear().domain(domain).ticks(count);
            };

            scale.tickFormat = function (count, specifier) {
                return oldD3.scaleLinear().domain(domain).tickFormat(count, specifier);
            };

            return scale;
        }

        function LightenDarkenColor(col, amt) {

            var usePound = false;

            if (col[0] == "#") {
                col = col.slice(1);
                usePound = true;
            }

            var num = parseInt(col, 16);

            var r = (num >> 16) + amt;

            if (r > 255) r = 255;
            else if (r < 0) r = 0;

            var b = ((num >> 8) & 0x00FF) + amt;

            if (b > 255) b = 255;
            else if (b < 0) b = 0;

            var g = (num & 0x0000FF) + amt;

            if (g > 255) g = 255;
            else if (g < 0) g = 0;

            return (usePound ? "#" : "") + (g | (b << 8) | (r << 16)).toString(16);

        }
        var selectedRid = 1;
        var selectedRid2 = 0;
        var counter = 0;
        var options = ["crime", "police", "rating", "inspection_score", "hospital", "injury", "parking"];


        var types = JSON.parse(localStorage.getItem("crime_types"));
        var finData = {
            'Dist': 5000,
            "options": options,
            'option': "",
            'crime_types': types,
            "Dist": 5000,
            "coordinates": [
                parseFloat(localStorage.getItem("lng")),
                parseFloat(localStorage.getItem("lat"))
            ]
        };

        var global_response;

        function drawRadialChart(response) {

            options = ["crime", "police", "rating", "inspection_score", "hospital", "injury", "parking"];

            var tooltip = oldD3.select("body").append("div").attr("class", "toolTip");
            //console.log(data);
            var svg = oldD3.select("#inside").append("svg").attr("width", 960).attr("height", 960),
                width = +svg.attr("width"),
                height = +svg.attr("height"),
                innerRadius = 180,
                outerRadius = Math.min(width, height) / 2,
                g = svg.append("g").attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

            var x = oldD3.scaleBand()
                .range([0, 2 * Math.PI])
                .align(0);

            var y = scaleRadial()
                .range([innerRadius, outerRadius]);

            var z = oldD3.scaleOrdinal()
                .range([

                    LightenDarkenColor("#e41a1c", -80),
                    LightenDarkenColor("#377eb8", -30),
                    LightenDarkenColor("#4daf4a", -60),
                    LightenDarkenColor("#984ea3", -80),
                    LightenDarkenColor("#ff7f00", -80),
                    LightenDarkenColor("#ffff33", -80),
                    LightenDarkenColor("#a65628", -80)]);
            data = [];
            for (var i = 0; i < response.length; i++) {
                var temp = {};

                temp['State'] = response[i]['name'];
                temp['rid'] = i;
                temp['crime'] = response[i]['crime'];
                temp['hospital'] = response[i]['hospital'];
                temp['parking'] = response[i]['parking'];
                temp['rating'] = response[i]['rating'];
                temp['inspection_score'] = response[i]['inspection_score'];
                temp['police'] = response[i]['police'];
                temp['injury'] = response[i]['injury'];
                temp['image'] = response[i]['image'];
                var total = 0;
                for (var j = 0; j < options.length; j++)
                    total += response[i][options[j]];
                temp['total'] = total;
                //temp['total'] = response[i]['parking'] + response[i]['crime'] + response[i]['hospital'] + response[i]['rating'] + response[i]['police'] + temp['inspection_score'] + temp['injury'];
                data.push(temp);

            }
            var counter = 0;
            var numRes = data.length;

            //data.columns = ["State", "crime", "injury", "hospital", "parking", "inspection_score", "police", "rating"];
            data.columns = options;
            data.columns.unshift("State");
            //console.log(data.columns);
            x.domain(data.map(function (d) {
                return d.State;
            }));
            y.domain([0, oldD3.max(data, function (d) {
                return d.total;
            })]);
            z.domain(data.columns.slice(1));

            var label = g.append("g")
                .selectAll("g")
                .data(data)
                .enter().append("g")
                .attr("text-anchor", "middle")
                .attr("transform", function (d) {
                    return "rotate(" + ((x(d.State) + x.bandwidth() / 2) * 180 / Math.PI - 90) + ")translate(" + innerRadius + ",0)";
                });

            A = -1;

            g.append("g")
                .selectAll("g")
                .data(oldD3.stack().keys(data.columns.slice(1))(data))
                .enter().append("g")
                .attr("fill", function (d) {
                    return z(d.key);
                })
                .selectAll("path")
                .data(function (d) {
                    return d;
                })
                .enter().append("path").on("mouseout", function (d) {
                tooltip.style("display", "none");
            })
                .on("mouseover", function (d) {
                    tooltip
                        .style("left", oldD3.event.pageX - 50 + "px")
                        .style("top", oldD3.event.pageY - 70 + "px")
                        .style("display", "inline-block")
                        //.html(d.data.State + "" + String((d[1] - d[0]).toFixed(2)));
                        .html(d.data.State);
                    if (selectedRid != d.data.rid) {
                        selectedRid = d.data.rid;
                        $("#inside").html("");
                        tooltip.style("display", "none");
                        drawRadialChart(global_response);
                        {#                        righto=global_response[selectedRid2];#}
                        {#                        lefto=global_response[selectedRid];#}
                        {#                        for(var i =1;i<options.length;i++) {#}
                        {#                            var opop=options[i];#}
                        {#                            console.log("panel_" + opop);#}
                        {#                            console.log(lefto["panel_" + opop]);#}
                        {#                            console.log(righto["panel_" + opop]);#}
                        {#                            jQuery("#panel_div_"+opop).css("height","170px");#}
                        {#                            jQuery("#rest1").html(righto["name"]);#}
                        {#                            jQuery("#rest2").html(lefto["name"]);#}
                        {#                            createDonut(lefto["panel_" + opop][1], righto["panel_" + opop][1], lefto["panel_" + opop][0], lefto["name"], righto["name"], "panel_div_" + opop);#}
                        {#                        }#}
                    }
                }).on("click", function (d) {
                if (selectedRid2 != d.data.rid) {
                    selectedRid2 = d.data.rid;
                    $("#inside").html("");
                    tooltip.style("display", "none");
                    drawRadialChart(global_response);
                    {#                        righto=global_response[selectedRid2];#}
                    {#                        lefto=global_response[selectedRid];#}
                    {#                        for(var i =1;i<options.length;i++) {#}
                    {#                            var opop=options[i];#}
                    {#                            console.log("panel_" + opop);#}
                    {#                            console.log(lefto["panel_" + opop]);#}
                    {#                            console.log(righto["panel_" + opop]);#}
                    {#                            jQuery("#panel_div_"+opop).css("height","170");#}
                    {#                            jQuery("#rest1").html(righto["name"]);#}
                    {#                            jQuery("#rest2").html(lefto["name"]);#}
                    {#                            createDonut(lefto["panel_" + opop][1], righto["panel_" + opop][1], lefto["panel_" + opop][0], lefto["name"], righto["name"], "panel_div_" + opop);#}
                    {#                        }#}
                }
            }).each(function (d) {
                if (counter % numRes == selectedRid) {
                    oldD3.select(this)
                    //              .style("stroke", "#000000")
                    //              .style("stroke-width", 3)
                        .style("fill", LightenDarkenColor(jQuery(oldD3.select(this)['_groups'][0][0]).parent().attr('fill'), 50));
                }

                if (counter % numRes == selectedRid2) {
                    oldD3.select(this)
                    //            .style("stroke", "#000000")
                    //            .style("stroke-width", 3)
                        .style("fill", LightenDarkenColor(jQuery(oldD3.select(this)['_groups'][0][0]).parent().attr('fill'), 120));
                }

                counter += 1;
            })
                .attr("d", oldD3.arc()
                    .innerRadius(function (d) {
                        return y(d[0]);
                    })
                    .outerRadius(function (d) {
                        return y(d[1]);
                    })
                    .startAngle(function (d) {
                        return x(d.data.State);
                    })
                    .endAngle(function (d) {
                        return x(d.data.State) + x.bandwidth();
                    })
                    .padAngle(0.01)
                    .padRadius(innerRadius));


            label.append("line")
                .attr("x2", -5)
                .attr("stroke", "#000");


            label.attr("class", "img-circle")
                .append("image")
                .attr("xlink:href", function (d) {
                    //   console.log(d);
                    return d.image;
                })
                .attr("width", 25)
                .attr("height", 25)
                //.attr("transform", "translate(-30, -10)");
                .attr("transform", function (d) {
                    return (x(d.State) + x.bandwidth() / 2 + Math.PI / 2) % (2 * Math.PI) <= Math.PI ? "rotate(90)translate(-12, 10)" : "rotate(-90)translate(-12, -35)";
                });


            //.text(function(d) { return d.State[0]; });
//.attr("transform", function(d) { console.log(x(d.State)); return (x(d.State) + x.bandwidth() / 2 + Math.PI / 2) % (2 * Math.PI) < Math.PI ? "rotate(90)translate(0,16)" : "rotate(-90)translate(0,-9)"; })

            var yAxis = g.append("g")
                .attr("text-anchor", "middle");

            var yTick = yAxis
                .selectAll("g")
                .data(y.ticks(5).slice(1))
                .enter().append("g");

            yTick.append("circle")
                .attr("fill", "none")
                .attr("stroke", "#000")
                .attr("r", y);

            yTick.append("text")
                .attr("y", function (d) {
                    return -y(d);
                })
                .attr("dy", "0.35em")
                .attr("fill", "none")
                .attr("stroke", "#fff")
                .attr("stroke-width", 5)
                .text(y.tickFormat(5, "s"));

            yTick.append("text")
                .attr("y", function (d) {
                    return -y(d);
                })
                .attr("dy", "0.35em")
                .text(y.tickFormat(5, "s"));

            yAxis.append("text")
                .attr("y", function (d) {
                    return -y(y.ticks(5).pop());
                })
                .attr("dy", "-1em")
                .text("Normalized Count");

            var legend = g.append("g")
                .selectAll("g")
                .data(data.columns.slice(1).reverse())
                .enter().append("g")
                .attr("transform", function (d, i) {
                    return "translate(-40," + (i - (data.columns.length - 1) / 2) * 20 + ")";
                });

            legend.append("rect")
                .attr("width", 18)
                .attr("height", 18)
                .attr("fill", z);

            legend.append("text")
                .attr("x", 24)
                .attr("y", 9)
                .attr("dy", "0.35em")
                .text(function (d) {
                    return d;
                });
            var righto = global_response[selectedRid2];
            var lefto = global_response[selectedRid];
            for (var i = 1; i < options.length; i++) {
                var opop = options[i];
                console.log("panel_" + opop);
                console.log(lefto["panel_" + opop]);
                console.log(righto["panel_" + opop]);
                jQuery("#panel_div_" + opop).css("height", "300");
                jQuery(".rest1").html(righto["name"]);
                jQuery(".rest2").html(lefto["name"]);
                createDonut(lefto["panel_" + opop][1], righto["panel_" + opop][1], lefto["panel_" + opop][0], lefto["name"], righto["name"], "panel_div_" + opop);
            }
            $(".card-block").perfectScrollbar();
        }
        var data = [];
        $.ajax({
            async: true,
            url: "/linedataMihir",
            type: 'POST',
            data: JSON.stringify(finData),
            timeout: 10000,
            success: function (response) {
                response = JSON.parse(response);
                response = response['radial'];
                global_response = response;
                console.log(response);
                drawRadialChart(global_response);
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                response = 'err--' + XMLHttpRequest.status + ' -- ' + XMLHttpRequest.statusText;
            }
        });

    </script>
    {#    horizonatl bar for place#}
    <script>
        function placesHorizontalBar() {

            var svg = oldD3.select("#placeHorizontal"),
                margin = {
                    top: 20, right: 20, bottom: 60, left: 520
                },
                width = +svg.attr("width") - margin.left - margin.right,
                height = +svg.attr("height") - margin.top - margin.bottom;

            var tooltip = oldD3.select("body").append("div").attr("class", "toolTip");
            var x = oldD3.scaleLinear().range([0, width]);
            var y = oldD3.scaleBand().range([height, 0]);

            var Parameter = {"crime": "Crimes ", "rating": "Rating ", "popularity": "Popularity "};

            var data = [];
            {#            console.log("ready!");#}
            oldD3.selectAll("#placeHorizontal > *").remove();

            var g = svg.append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            var finData = {
                'time_upper_bound': "20:00:00",
                'time_lower_bound': "06:00:00",
                'crime_types': JSON.parse(localStorage.getItem("crime_types"))
            };

            $.ajax({
                async: true,
                url: "/placesHorizontal",
                type: 'POST',
                data: JSON.stringify(finData),
                timeout: 10000,
                success: function (response) {
                    var haha = jQuery("#placesBar option:selected").attr("val");
                    {#                    console.log(response);#}
                    response = JSON.parse(response);
                    for (var i = 0; i < response.length; i++) {
                        var temp = {};
                        {#                        console.log(response[i]);#}
                        temp["area"] = response[i]["name"];
                        temp["value"] = response[i][haha];
                        data.push(temp);
                    }

                    x.domain([0, oldD3.max(data, function (d) {
                        return d.value;
                    })]);
                    y.domain(data.map(function (d) {
                        return d.area;
                    })).padding(0.1);

                    g.append("g")
                        .attr("class", "y axis")
                        .call(oldD3.axisLeft(y)).selectAll('text')
                        .style('font-size', '17px')
                        .style('font', 'arial', 'sans-serif');

                    g.append("g")
                        .attr("transform", "translate(0," + height + ")")
                        .call(oldD3.axisBottom(x)).selectAll('text')
                        .style('font-size', '17px')
                        .style('font', 'arial', 'sans-serif');
                    g.append("text")
                        .attr("transform",
                            "translate(" + (width / 2) + " ," +
                            (height + margin.top + 35) + ")")
                        .style("text-anchor", "middle")
                        .style("font-size", "25px")
                        .text("Crime Counts");

                    // text label for the y axis
                    g.append("text")
                        .attr("transform", "rotate(-90)")
                        .attr("y", 0 - margin.left)
                        .attr("x", 0 - (height / 2))
                        .attr("dy", "1em")
                        .style("text-anchor", "middle")
                        .style("font-size", "25px")
                        .text("Place Name");
                    g.selectAll(".bar")
                        .data(data)
                        .enter().append("rect")
                        .attr("class", "bar")
                        .attr("x", 0)
                        .attr("height", y.bandwidth())
                        .attr("y", function (d) {
                            return y(d.area);
                        })
                        .attr("width", function (d) {
                            return x(d.value);
                        })
                        .on("mousemove", function (d) {
                            tooltip
                                .style("left", oldD3.event.pageX - 50 + "px")
                                .style("top", oldD3.event.pageY - 70 + "px")
                                .style("display", "inline-block")
                                .html((d.area) + "<br>" + Parameter[haha] + (d.value));
                        })
                        .on("mouseout", function (d) {
                            tooltip.style("display", "none");

                        });
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    response = "err--" + XMLHttpRequest.status + " -- " + XMLHttpRequest.statusText;
                }
            });
        }
        {#box plot #}
    </script>

    <script lang='babel' type='text/babel'>

        function boxPlot() {
            var finData = {
                "id": localStorage.getItem(("restaurantId")),
                "Dist": 5000,
                "coordinates": [
                    parseFloat(localStorage.getItem("restaurantLong")),
                    parseFloat(localStorage.getItem("restaurantLat"))
                ],
                "crime_types": JSON.parse(localStorage.getItem("crime_types"))
            };
            console.log("hiii", finData);

            var crimeList = [];
            var ratingList = [];
            var policeList = [];
            var parkingList = [];
            var hospitalList = [];
            $.ajax({
                async: true,
                url: "/gaugedata",
                type: 'POST',
                data: JSON.stringify(finData),
                timeout: 20000,
                success: function (response) {

                    response = JSON.parse(response);
                    console.log(response);

                    var crime = 0;
                    var hospital = 0;
                    var parking = 0;
                    var rating = 0;
                    var police = 0;
                    var name = "";

                    for (var i = 0; i < response.length; i++) {

                        crimeList.push(response[i]["crime"]);
                        ratingList.push(response[i]["rating"]);
                        policeList.push(response[i]["police"]);
                        parkingList.push(response[i]["parking"]);
                        hospitalList.push(response[i]["hospital"]);

                        if (response[i]["isApnaVala"] == 1) {
                            crime = response[i]["crime"];
                            hospital = response[i]["hospital"];
                            parking = response[i]["parking"];
                            rating = response[i]["rating"];
                            police = response[i]["police"];
                            name = response[i]['name']
                        }
                    }

                    var Crime = {
                        y: crimeList,
                        type: 'box',
                        mode: 'markers',
                        name: 'Crime'
                    };

                    var CrimeApna = {
                        y: [crime],
                        type: 'box',
                        name: 'Crime',
                        showlegend: false
                    };

                    var Rating = {
                        y: ratingList,
                        type: 'box',
                        mode: 'markers',
                        name: 'Rating'
                    };

                    var RatingApna = {
                        y: [rating],
                        type: 'box',
                        name: 'Rating',
                        showlegend: false
                    };

                    var Hospital = {
                        y: ratingList,
                        type: 'box',
                        mode: 'markers',
                        name: 'Hospital'
                    };

                    var HospitalApna = {
                        y: [hospital],
                        type: 'box',
                        name: 'Hospital',
                        mode: 'text',
                        showlegend: false
                    };

                    var Police = {
                        y: ratingList,
                        type: 'box',
                        mode: 'markers',
                        name: 'Police'
                    };

                    var PoliceApna = {
                        y: [police],
                        type: 'box',
                        name: 'Police',
                        showlegend: false
                    };
                    var data = [Crime, CrimeApna, Rating, RatingApna, Hospital, HospitalApna, Police, PoliceApna];
                    var layout = {
                        autosize: false,
                        width: 2000,
                        height: 1000,
                        margin: {
                            l: 500,
                            r: 300,
                            pad: 4
                        },
                        annotations: [
                            {
                                x: 0,
                                y: crime,
                                xref: 'x',
                                yref: 'y',
                                text: name + " CRIME",
                                showarrow: true,
                                font: {
                                    family: 'Courier New, monospace',
                                    size: 16,
                                    color: '#ffffff '
                                },
                                align: 'center',
                                arrowhead: 2,
                                arrowsize: 1,
                                arrowwidth: 2,
                                arrowcolor: '#636363 ',
                                ax: 20,
                                ay: -30,
                                bordercolor: '#c7c7c7 ',
                                borderwidth: 2,
                                borderpad: 4,
                                bgcolor: '#ff7f0e ',
                                opacity: 0.8
                            },
                            {
                                x: 1,
                                y: rating,
                                xref: 'x',
                                yref: 'y',
                                text: name + " RATING",
                                showarrow: true,
                                font: {
                                    family: 'Courier New, monospace',
                                    size: 16,
                                    color: '#ffffff '
                                },
                                align: 'center',
                                arrowhead: 2,
                                arrowsize: 1,
                                arrowwidth: 2,
                                arrowcolor: '#636363 ',
                                ax: 20,
                                ay: -30,
                                bordercolor: '#c7c7c7 ',
                                borderwidth: 2,
                                borderpad: 4,
                                bgcolor: '#ff7f0e ',
                                opacity: 0.8
                            },
                            {
                                x: 2,
                                y: hospital,
                                xref: 'x',
                                yref: 'y',
                                text: name + " HOSPITAL",
                                showarrow: true,
                                font: {
                                    family: 'Courier New, monospace',
                                    size: 16,
                                    color: '#ffffff '
                                },
                                align: 'center',
                                arrowhead: 2,
                                arrowsize: 1,
                                arrowwidth: 2,
                                arrowcolor: '#636363 ',
                                ax: 20,
                                ay: -30,
                                bordercolor: '#c7c7c7 ',
                                borderwidth: 2,
                                borderpad: 4,
                                bgcolor: '#ff7f0e ',
                                opacity: 0.8
                            },
                            {
                                x: 3,
                                y: police,
                                xref: 'x',
                                yref: 'y',
                                text: name + " POLICE",
                                showarrow: true,
                                font: {
                                    family: 'Courier New, monospace',
                                    size: 16,
                                    color: '#ffffff '
                                },
                                align: 'center',
                                arrowhead: 2,
                                arrowsize: 1,
                                arrowwidth: 2,
                                arrowcolor: '#636363 ',
                                ax: 20,
                                ay: -30,
                                bordercolor: '#c7c7c7 ',
                                borderwidth: 2,
                                borderpad: 4,
                                bgcolor: '#ff7f0e ',
                                opacity: 0.8
                            }
                        ]
                    };
                    Plotly.newPlot('boxPlot', data, layout);
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    response = "err--" + XMLHttpRequest.status + " -- " + XMLHttpRequest.statusText;
                }
            });
        }
    </script>
    <script>
        function getDataHeat() {
            var data = {};
            var crime = {};
            var finData = {"restaurantId": localStorage.getItem("restaurantId")}
            $.ajax({
                async: true,
                url: "/getRestaurantHeatMap",
                type: 'POST',
                data: JSON.stringify(finData),
                timeout: 10000,
                success: function (result) {
                    //console.log(result);
                    var obj = JSON.parse(result);
                    data = obj["popularTime"];
                    crime = obj["crimeData"];
                    //console.log(crime);
                    drawHeatMap(data);
                    drawHeatCrime(crime);
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    response = "err--" + XMLHttpRequest.status + " -- " + XMLHttpRequest.statusText;
                }
            });
        }
        function drawHeatMap(data) {
            //console.log(data);
            var margin = {top: 50, right: 0, bottom: 100, left: 100},
                width = 960 - margin.left - margin.right,
                height = 300 - margin.top - margin.bottom,
                gridSize = Math.floor(width / 20),
                legendElementWidth = gridSize * 2,
                buckets = 6,
                colors = ["#1a9850", "#66bd63", "#a6d96a", "#d9ef8b", "#ffffbf", "#fee08b", "#fdae61", "#f46d43", "#d73027"],
                // colors = ["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"], // alternatively colorbrewer.YlGnBu[9]
                days = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
                times = ["6:00", "7:00", "8:00", "9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00", "16:00", "17:00", "18:00", "19:00", "20:00", "21:00", "22:00", "23:00"];


            var colorScale = oldD3.scaleQuantile()
                .domain([0, buckets - 1, oldD3.max(data, function (d) {
                    return d.value;
                })])
                .range(colors);
            oldD3.selectAll("#chartPopularity > *").remove();
            var svg = oldD3.select("#chartPopularity").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            var dayLabels = svg.selectAll(".dayLabel")
                .data(days)
                .enter().append("text")
                .text(function (d) {
                    return d;
                })
                .attr("x", 0)
                .attr("y", function (d, i) {
                    return i * gridSize;
                })
                .style("text-anchor", "end")
                .attr("transform", "translate(-6," + gridSize / 1.5 + ")")
                .attr("class", function (d, i) {
                    return ((i >= 0 && i <= 5) ? "dayLabel mono axis axis-workweek" : "dayLabel mono axis");
                });

            var timeLabels = svg.selectAll(".timeLabel")
                .data(times)
                .enter().append("text")
                .text(function (d) {
                    return d;
                })
                .attr("x", function (d, i) {
                    return i * gridSize;
                })
                .attr("y", 0)
                .style("text-anchor", "middle")
                .attr("transform", "translate(" + gridSize / 2 + ", -6)")
                .attr("class", function (d, i) {
                    return ((i >= 0 && i <= 18) ? "timeLabel mono axis axis-worktime" : "timeLabel mono axis");
                });

            var heatMap = svg.selectAll(".hour")
                .data(data)
                .enter().append("rect")
                .attr("x", function (d) {
                    return (d.hour - 1) * gridSize;
                })
                .attr("y", function (d) {
                    return (d.day - 1) * gridSize;
                })
                .attr("rx", 4)
                .attr("ry", 4)
                .attr("class", "hour bordered")
                .attr("width", gridSize)
                .attr("height", gridSize)
                .style("fill", colors[0]);

            heatMap.transition().duration(1000)
                .style("fill", function (d) {
                    return colorScale(d.value);
                });

            heatMap.append("title").text(function (d) {
                return d.value;
            });


        }
        function drawHeatCrime(crime) {
            data = crime
            //console.log(data);
            var margin = {top: 50, right: 0, bottom: 100, left: 100},
                width = 960 - margin.left - margin.right,
                height = 430 - margin.top - margin.bottom,
                gridSize = Math.floor(width / 20),
                legendElementWidth = gridSize * 2,
                buckets = 6,
                colors = ["#1a9850", "#66bd63", "#a6d96a", "#d9ef8b", "#ffffbf", "#fee08b", "#fdae61", "#f46d43", "#d73027"],
                // colors = ["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"], // alternatively colorbrewer.YlGnBu[9]
                days = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
                times = ["6:00", "7:00", "8:00", "9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00", "16:00", "17:00", "18:00", "19:00", "20:00", "21:00", "22:00", "23:00"];


            var colorScale = oldD3.scaleQuantile()
                .domain([0, buckets - 1, oldD3.max(data, function (d) {
                    return d.value;
                })])
                .range(colors);
            oldD3.selectAll("#chartCrime > *").remove();
            var svg = oldD3.select("#chartCrime").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            var dayLabels = svg.selectAll(".dayLabel")
                .data(days)
                .enter().append("text")
                .text(function (d) {
                    return d;
                })
                .attr("x", 0)
                .attr("y", function (d, i) {
                    return i * gridSize;
                })
                .style("text-anchor", "end")
                .attr("transform", "translate(-6," + gridSize / 1.5 + ")")
                .attr("class", function (d, i) {
                    return ((i >= 0 && i <= 5) ? "dayLabel mono axis axis-workweek" : "dayLabel mono axis");
                });

            var timeLabels = svg.selectAll(".timeLabel")
                .data(times)
                .enter().append("text")
                .text(function (d) {
                    return d;
                })
                .attr("x", function (d, i) {
                    return i * gridSize;
                })
                .attr("y", 0)
                .style("text-anchor", "middle")
                .attr("transform", "translate(" + gridSize / 2 + ", -6)")
                .attr("class", function (d, i) {
                    return ((i >= 0 && i <= 18) ? "timeLabel mono axis axis-worktime" : "timeLabel mono axis");
                });

            var heatMap = svg.selectAll(".hour")
                .data(data)
                .enter().append("rect")
                .attr("x", function (d) {
                    return (d.hour - 1) * gridSize;
                })
                .attr("y", function (d) {
                    return (d.day - 1) * gridSize;
                })
                .attr("rx", 4)
                .attr("ry", 4)
                .attr("class", "hour bordered")
                .attr("width", gridSize)
                .attr("height", gridSize)
                .style("fill", colors[0]);


            heatMap.transition().duration(1000)
                .style("fill", function (d) {
                    return colorScale(d.value);
                });

            heatMap.append("title").text(function (d) {
                return d.value;
            });

            var legend = svg.selectAll(".legend")
                .data([0].concat(colorScale.quantiles()), function (d) {
                    return d;
                })
                .enter().append("g")
                .attr("class", "legend");

            legend.append("rect")
                .attr("x", function (d, i) {
                    return legendElementWidth * i;
                })
                .attr("y", height)
                .attr("width", legendElementWidth)
                .attr("height", gridSize / 2)
                .style("fill", function (d, i) {
                    return colors[i];
                });

            legend.append("text")
                .attr("class", "mono")
                .text(function (d) {
                    return " " + Math.round(d);
                })
                .attr("x", function (d, i) {
                    return legendElementWidth * i;
                })
                .attr("y", height + gridSize);
        }


    </script>
    <script>
        function clipText(d, t) {


            if (d.r < 40) {
                return "";
            }

            var name = t.substring(0, d.r / 5);
            if (name.length < t.length) {
                name = name.substring(0, name.length - Math.min(2, name.length)) + "...";
            }

            return name;

        }
        function displayBubble() {

            var tooltip = oldD3.select("body").append("div").attr("class", "toolTip");

            oldD3.selectAll("#bubble > *").remove();
            var svg = oldD3.select("#bubble").attr("font-size", "15"),
                width = +svg.attr("width"),
                height = +svg.attr("height");


            var color = oldD3.scaleOrdinal(oldD3.schemeCategory20c);
            var format = oldD3.format(",d");

            var pack = oldD3.pack()
                .size([width, height])
                .padding(1.5);
            var finData = {
                "restaurantId": localStorage.getItem(("restaurantId")),
                "crime_types": JSON.parse(localStorage.getItem("crime_types"))
            };
            $.ajax({
                async: true,
                url: "/getBubbleData",
                type: 'POST',
                data: JSON.stringify(finData),
                timeout: 20000,
                success: function (response) {
                    response = JSON.parse(response);
                    var data = [];
                    Object.keys(response).forEach(function (key) {
                        var temp = {};
                        temp['value'] = response[key];
                        temp['id'] = key;
                        data.push(temp);
                    });


                    var root = oldD3.hierarchy({children: data})
                        .sum(function (d) {
                            return d.value;
                        })
                        .each(function (d) {
                            if (id = d.data.id) {
                                var id, i = id.lastIndexOf(".");
                                d.id = id;
                                d.package = id.slice(0, i);
                                d.class = id.slice(i + 1);
                            }
                        });

                    var node = svg.selectAll(".node")
                        .data(pack(root).leaves())
                        .enter().append("g")
                        .attr("class", "node")
                        .attr("transform", function (d) {
                            return "translate(" + d.x + "," + d.y + ")";
                        });

                    node.append("circle")
                        .attr("id", function (d) {
                            return d.id;
                        })
                        .attr("r", function (d) {
                            return d.r;
                        })
                        .style("fill", function (d) {
                            return color(d.package);
                        }).on("mouseover", function () {
                        oldD3.select(this).style("opacity", "0.8");
                    })
                        .on("mousemove", function (d) {
                            tooltip
                                .style("left", oldD3.event.pageX - 50 + "px")
                                .style("top", oldD3.event.pageY - 70 + "px")
                                .style("display", "inline-block")
                                .html(d.id + ": " + d.value);
                        })
                        .on("mouseout", function (d) {
                            tooltip.style("display", "none");
                            oldD3.select(this).style("opacity", "1");
                        });
                    var text = node.append("text")
                        .attr("dy", ".3em")
                        .style("text-anchor", "middle")
                        .style("fill", "#fff");

                    text.append("tspan")
                        .attr("x", 0)
                        .attr("y", 0)
                        .text(function (d) {
                            return clipText(d, d.id);
                        });
                    {#                    node.append("clipPath")#}
                    {#                        .attr("id", function (d) {#}
                    {#                            return "clip-" + d.id;#}
                    {#                        })#}
                    {#                        .append("use")#}
                    {#                        .attr("xlink:href", function (d) {#}
                    {#                            return "#" + d.id;#}
                    {#                        });#}
                    {##}
                    {#                    node.append("text")#}
                    {#                        .selectAll("tspan")#}
                    {#                        .data(function (d) {#}
                    {#                            return d.class.split(/(?=[^A-Z])/g);#}
                    {#                        })#}
                    {#                        .enter().append("tspan")#}
                    {#                        .attr("x", 0)#}
                    {#                        .attr("y", function (d, i, nodes) {#}
                    {#                            return 13 + (i - nodes.length / 2 - 0.5) * 10;#}
                    {#                        })#}
                    {#                        .text(function (d) {#}
                    {#                            return d;#}
                    {#                        });#}


                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    response = "err--" + XMLHttpRequest.status + " -- " +
                        XMLHttpRequest.statusText;
                }
            });
        }

    </script>
    {#    sankey#}
    <script lang='babel' type='text/babel'>
        var energy = {};
        function displaySankey() {
            var options = ["HOSPITALS", "POLICE PRECINCTS", "PARKING"];
            var types = ["DANGEROUS DRUGS",
                "ROBBERY",
                "ASSAULT 3 & RELATED OFFENSES",
                "DANGEROUS WEAPONS",
                "PETIT LARCENY",
                "GRAND LARCENY",
                "HARRASSMENT 2",
                "BURGLARY",
                "FORGERY",
                "SEX CRIMES",
                "BURGLAR'S TOOLS",
                "THEFT-FRAUD"];

            var finData = {
                "options": options,
                "restaurantId": localStorage.getItem("restaurantId"),
                "distance": 5000,
                'crime_types': types
            };
            $("#chartSankey").empty();
            $.ajax({
                async: true,
                url: "/sankeyData",
                timeout: 400000,
                type: 'POST',
                data: JSON.stringify(finData),
                success: function (response) {
                    //console.log(response);
                    response = JSON.parse(response);
                    // console.log(response);
                    energy = response;
                    drawSankey(energy);
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    response = 'err--' + XMLHttpRequest.status + ' -- ' + XMLHttpRequest.statusText;
                }
            });
        }


        function drawSankey() {

            oldD3.selectAll("#chartSankey > *").remove();

            const marginw = {
                top: 1,
                right: 1,
                bottom: 6,
                left: 1
            };

            const widthw = 1800 - marginw.left - marginw.right;
            const heightw = 950 - marginw.top - marginw.bottom;
            const formatNumberw = oldD3.format(',.0f');
            const formatw = d => '${formatNumberw(d)} TWh';
            const colorw = oldD3.scaleOrdinal(oldD3.schemeCategory20);
            const svgw = oldD3.select('#chartSankey').append('svg')
                .attr('width', widthw + marginw.left + marginw.right)
                .attr('height', heightw + marginw.top + marginw.bottom)
                .append('g')
                .attr('transform', `translate(${marginw.left},${marginw.top})`);

            const sankey2 = d3_sankey.sankey()
                .nodeWidth(15)
                .nodePadding(10)
                .size([widthw, heightw]);

            const pathw = sankey2.link();
            sankey2
                .nodes(energy.nodes)
                .links(energy.links)
                .layout(32);

            const linkw = svgw.append('g').selectAll('.link')
                .data(energy.links)
                .enter().append('path')
                .attr('class', 'link')
                .attr('d', pathw)
                .style('stroke-width', d => Math.max(1, d.dy))
                .sort((a, b) => b.dy - a.dy);

            linkw.append('title')
                .text(d => `${d.source.name}  ${d.target.name}\n${formatw(d.value)}`);

            const nodew = svgw.append('g').selectAll('.node')
                .data(energy.nodes)
                .enter().append('g')
                .attr('class', 'node')
                .attr('transform', d => `translate(${d.x},${d.y})`)
                .call(oldD3.drag()
                    .subject(d => d)
                    .on('start', function () {
                        this.parentNode.appendChild(this);
                    })
                    .on('drag', dragmove));

            nodew.append('rect')
                .attr('height', d => d.dy)
                .attr('width', sankey2.nodeWidth())
                .style('fill', d => d.color = colorw(d.name.replace(/ .*/, '')))
                .style('stroke', d => oldD3.rgb(d.color).darker(2))
                .append('title')
                .text(d => `${d.name}\n${formatw(d.value)}`);

            nodew.append('text')
                .attr('x', -6)
                .attr('y', d => d.dy / 2)
                .attr('dy', '.35em')
                .attr('text-anchor', 'end')
                .attr('transform', null)
                .text(d => d.name)
                .filter(d => d.x < widthw / 2)
                .attr('x', 6 + sankey2.nodeWidth())
                .attr('text-anchor', 'start');

            function dragmove(d) {
                oldD3.select(this).attr('transform', `translate(${d.x},${d.y = Math.max(0, Math.min(heightw - d.dy, oldD3.event.y))})`);
                sankey2.relayout();
                linkw.attr('d', pathw);
            }
        }


        jQuery("#chartSankey").css("height", "1000px");

    </script>
</head>
<body>

<div class="w3-cell-row" style="width: 100%;height: 80%">
    <div id="place" class="w3-container w3-cell" style="height: 900px;width: 410px;padding: 3px;">
        <div class="card">
            <div class="card-header" style="background-color: #03a9f4;text-align: center;color: white">
                <b><h1 style="font-size: 45px;">Places Of Interest</h1></b>
                <p>The major tourist attractions in New York City!!</p>
            </div>
            <div class="card-block" style="height:1024px;padding: 10px">
                <div id="scrollNew" style="height:990px; width:410px;">
                    <div id="placeOf">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="jsPanelLegend"></div>

    <div id="jsPanelCheck"></div>
    <div id="jsPanelPlace"></div>
    <div id="jsPanelRest"></div>
    <div class="w3-container w3-cell" id="esri-map-container"></div>
</div>

<div class="restChart">
    <h2 style="text-align: center">
        <div class="myTitle"></div>
    </h2>
</div>

<div class="container-fluid restChart">
    <div class="card with-nav-tabs ">
        <div class="card-heading card-default">
            <ul class="nav nav-tabs">
                <li class="nav-item"><a class="nav-link active" href="#tab3success" data-toggle="tab">Normalized Value
                    Box Plot</a></li>
                <li class="nav-item"><a class="nav-link" href="#tab4success" data-toggle="tab">Hourly Heat Map</a>
                </li>
                <li class="nav-item"><a class="nav-link" href="#tab5success" data-toggle="tab">Crime Type Bubble</a></li>
                <li class="nav-item"><a class="nav-link" href="#tab6success" data-toggle="tab">Sankey Diagram for
                    <div class="myTitle"></div>
                </a></li>
            </ul>
        </div>
        <div class="card-body">
            <div class="tab-content">

                <div class="tab-pane fade" id="tab3success" style="text-align: center">
                    <h3>City metric normalized value ranges for top 30 restaurants within 3 km of
                        <div class="myTitle"></div>
                        (2016)
                    </h3>
                    <div id="boxPlot" width="2000" height="1000"></div>
                </div>
                <div class="tab-pane fade" id="tab4success" style="text-align: center;" width="2000" height="1000">
                    <h4>Hourly Popularity for
                        <div class="myTitle"></div>
                        (2016)
                    </h4>
                    <div id="chartPopularity"></div>
                    <h4>Hourly Crime Counts within 3 km of
                        <div class="myTitle"></div>
                        (2016)
                    </h4>
                    <div id="chartCrime"></div>
                </div>
                <div class="tab-pane fade" id="tab5success" style="text-align: center;">
                    <h3>Number of criminal activites within 3 km of
                        <div class="myTitle"></div>
                        (2016)
                    </h3>
                    <br>
                    <svg id="bubble" width="2000" height="1000" font-family="sans-serif" font-size="10"
                         text-anchor="middle"></svg>

                </div>
                <div class="tab-pane fade" id="tab6success">
                    <br>

                    <div id="chartSankey" style="text-align: center;"></div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="nearbyRestChart"><h2 style="text-align: center">Restaurants Analysis</h2></div>

<div class="container-fluid nearbyRestChart">
    <div class="card with-nav-tabs ">
        <div class="card-heading card-info">
            <ul class="nav nav-tabs">
                <li class=" nav-item"><a class="nav-link active" id="newp" href="#tab1success3" data-toggle="tab">Compare
                    Restaurants</a>
                </li>
                <li class="nav-item"><a class="nav-link" id="newp2" href="#tab2success3" data-toggle="tab">Bar Graph</a>
                </li>
            </ul>
        </div>
        <div class="card-body" style="background-color: #dff8ff ;">
            <div class="tab-content">
                <div class="tab-pane fade in active" style="height: 1000px" id="tab1success3">
                    <h3 style="text-align: center">Top 30 restaurants within 3 km of
                        <div class="mihirPlace"></div>
                        ordered by the score based on selected city metrics.
                    </h3>
                    <br>
                    <div id="myDiv2">
                        <div class="row">
                            <div class="col-sm-3">
                                <div class="card " style="height:950px;background-color: #333; border-color: #333;">
                                    <div class="card-header" style="text-align: center;">
                                        <b><span class="rest1" style="float: left;color: #c24642 ;font-size: 20px">Restaurant 1</span></b>
                                        <span>vs</span> <span class="rest2"
                                                              style="float: right;color: #369ead ;font-size: 20px">Restaurant 2</span>
                                    </div>
                                    <div class="card-block pre-scrollable" style="height: 950px;max-height: 950px;">
                                        <div id="panel_div_crime" style="width: 100%;"></div>
                                        <div id="panel_div_rating" style="width: 100%"></div>
                                        <div id="panel_div_hospital" style="width: 100%;"></div>
                                        <div id="panel_div_parking" style="width: 100%;"></div>
                                    </div>
                                </div>

                            </div>
                            <div class="col-sm-6">
                                <div id="inside"></div>
                            </div>
                            <div class="col-sm-3">
                                <div class="card " style="height:950px;background-color: #333; border-color: #333;">
                                    <div class="card-header" style="text-align: center;">
                                        <b><span class="rest1" style="float: left;color: #c24642 ;font-size: 20px">Restaurant 1</span></b>
                                        <span>vs</span> <span class="rest2"
                                                              style="float: right;color: #369ead ;font-size: 20px">Restaurant 2</span>
                                    </div>
                                    <div class="card-block pre-scrollable" style="height: 950px;max-height: 950px;">
                                        <div id="panel_div_police" style="width: 100%;"></div>
                                        <div id="panel_div_injury" style="width: 100%;"></div>
                                        <div id="panel_div_inspection_score" style="width: 100%;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="tab2success3" style="text-align: center">
                    <h3>City metric values for top 30 restaurants within 3 km of
                        <div class="mihirPlace"></div>
                        (2016)
                    </h3>
                    <div style="margin: auto;">
                        <br>
                        <div style="display: table-cell; text-align: center">
                            {#                              <label for="dropdown">Select factor:&nbsp; </label>#}
                            <select id="factordropdown" class="form-control" onchange="displayHorizontalBar()"
                                    style="height: 40px;">
                                <option val="crime">Criminal Activities</option>
                                <option val="hospital">Hospitals</option>
                                <option val="parking">Parking Places</option>
                                <option val="police">Police Precincts</option>
                                <option val="injury">Injuries</option>
                                <option val="inspection_score">Inspection Scores</option>
                                <option val="rating">Rating</option>
                            </select>
                        </div>
                    </div>
                    <svg id="horizontalBar" width="2000" height="1000"></svg>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="placeChart"><h2 style="text-align: center">Compare Places of interest</h2></div>

<div class="container-fluid placeChart">
    <div class="card with-nav-tabs ">
        <div class="card-heading card-success">
            <ul class="nav nav-tabs">
                <li class=" nav-item"><a class="nav-link active" id="newp" href="#tab1success2" data-toggle="tab">Compare
                    montly crime</a>
                </li>
                <li class="nav-item"><a class="nav-link" id="newp2" href="#tab2success2" data-toggle="tab">Bar graph</a>
                </li>
            </ul>
        </div>
        <div class="card-body" style="background-color: #e9ffe9">
            <div class="tab-content">
                <div class="tab-pane fade in active" style="height: 1000px" id="tab1success2">
                    {##}
                    {#                    <div class="loader" id="myDiv1Loader">#}
                    {#                    </div>#}

                    <div id="myDiv1">
                        <svg style="height:1000px;" id="chart1"></svg>
                    </div>

                </div>
                <div class="tab-pane fade" id="tab2success2" style="text-align: center">
                    <h3>City metric value for top tourist places in New York City (2016)</h3>

                    <div style="margin: auto;">
                        <div style="display: table-cell; width: auto;">
                            <br>
                            <select id="placesBar" class="form-control" onchange="placesHorizontalBar()"
                                    style="height: 40px;">
                                <option val="crime">crime</option>
                                <option val="rating">rating</option>
                                <option val="popularity">popularity</option>
                            </select>
                        </div>
                    </div>

                    <svg id="placeHorizontal" width="2000" height="1000"></svg>
                </div>

            </div>
        </div>
    </div>
</div>

<br>
<br>

</body>
</html>
